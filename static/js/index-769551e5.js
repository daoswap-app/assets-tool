import{t as r}from"./___vite-browser-external_commonjs-proxy-1cc6769e.js";import{u as S}from"./web3Modal-5bc085a0.js";import{c as Q,i as X}from"./addresses-1622ebb8.js";import{u as I}from"./wallet-4da08e9a.js";import{g as D,M as Y,e as H,T as Z,w as j}from"./web3-5a596777.js";import{E as z}from"./ERC20_abi-801f43f8.js";import{x as M,r as i,o as P,w as R,a7 as u,y as V,H as B,I as e,P as t,M as F,O as k,u as m,z as $,a0 as ee,F as te,aa as ae,A as y,J as le,L as se}from"./runtime-core.esm-bundler-c80a0204.js";import{g as ne,h as oe}from"./chains-db497463.js";import"./vue-i18n.runtime.esm-bundler-d653d868.js";import"./web3.min-9566e482.js";import"./index-9faba92d.js";import"./vue-router-935545c9.js";import"./utils-4c978675.js";const re=M({__name:"SendTransaction",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null},tokenList:{type:Object,default:()=>[]}},emits:["update:visible","refresh-asset-list"],setup(N,{emit:T}){const b=N,p=i(!1),v=i(!1),h=i(""),A=i(null),g=i(null),C={sendAddress:"",recipientAddress:"",assetToken:"",amount:""},W=i(),a=i(C);P(()=>{h.value=I().getWallet,A.value=S().getWallet,g.value=S().getWeb3,a.value.sendAddress=h.value});const E=(n,s,l)=>{s===""?l(new Error(r("transaction.please input recipient address"))):(a.value.recipientAddress=Q(a.value.recipientAddress),X(a.value.recipientAddress)?l():l(new Error(r("transaction.invalid recipient address"))))},L=(n,s,l)=>{s===""?l(new Error(r("transaction.please input amount"))):parseFloat(s)>parseFloat(b.data.balance)?l(new Error(r("transaction.exceed balance"))):l()},f=async()=>await W.value.validate(n=>!!n),w=async()=>{if(await f()){p.value=!0;const s=D(Y,I().getWallet,g.value),l={destination:a.value.recipientAddress,value:H(a.value.amount,g.value),data:"0x"};if(a.value.assetToken){const c=D(z,a.value.assetToken,g.value),o=H(a.value.amount,g.value),x=await c.methods.transfer(a.value.recipientAddress,o).encodeABI();l.destination=a.value.assetToken,l.value="0",l.data=x}s.methods.submitTransaction(l.destination,l.value,l.data).send({from:A.value.address}).then(()=>{T("refresh-asset-list")}).catch(c=>{console.error(c)}).finally(()=>{p.value=!1,_()})}},_=()=>{v.value=!1};return R(()=>v.value,n=>{T("update:visible",n)}),R(()=>b.visible,n=>{v.value=n}),R(()=>b.data,n=>{a.value.assetToken=n?n.token:""}),(n,s)=>{const l=u("el-col"),c=u("el-row"),o=u("el-form-item"),x=u("el-divider"),O=u("el-input"),q=u("el-option"),J=u("el-select"),K=u("el-form"),U=u("el-button"),G=u("el-dialog");return V(),B(G,{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=d=>v.value=d),title:m(r)("transaction.sendTokens"),width:"80%",draggable:"","close-on-click-modal":!1,"before-close":_},{footer:e(()=>[t(U,{loading:p.value,onClick:_},{default:e(()=>[F(k(m(r)("wallet.btnCancel")),1)]),_:1},8,["loading"]),t(U,{loading:p.value,type:"primary",onClick:w},{default:e(()=>[F(k(m(r)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:e(()=>[t(K,{ref_key:"transactionFormRef",ref:W,model:a.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:e(()=>[t(o,{prop:"sendAddress",label:m(r)("transaction.sendAddress"),style:{width:"100%"}},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[F(k(a.value.sendAddress),1)]),_:1})]),_:1})]),_:1},8,["label"]),t(x),t(o,{prop:"recipientAddress",label:m(r)("transaction.recipientAddress"),style:{width:"100%"},rules:[{validator:E,trigger:"blur"}]},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(O,{modelValue:a.value.recipientAddress,"onUpdate:modelValue":s[0]||(s[0]=d=>a.value.recipientAddress=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),t(o,{prop:"assetToken",label:m(r)("transaction.assetToken"),style:{width:"100%"}},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(J,{modelValue:a.value.assetToken,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value.assetToken=d),style:{width:"100%"}},{default:e(()=>[(V(!0),$(te,null,ee(b.tokenList,d=>(V(),B(q,{key:d.token,label:d.symbol+(d.token?" - "+d.token:""),value:d.token},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label"]),t(o,{prop:"amount",label:m(r)("transaction.amount"),style:{width:"100%"},rules:[{validator:L,trigger:"blur"}]},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(O,{modelValue:a.value.amount,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value.amount=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ie={class:"card-header"},ue={class:"font-medium"},de={style:{display:"flex","align-items":"left"}},ce=y("i",{class:"el-icon-time"},null,-1),me={style:{"margin-left":"10px"}},pe={style:{display:"flex","align-items":"left"}},ve={style:{"margin-left":"3px"}},_e=M({name:"Assets"}),Fe=M({..._e,setup(N){const T=i([]),b=i(!1),p=i(null),v=i(null),h=i([]),A=i(!1),g=i(null),C=i(null);async function W(){v.value=I().getWallet,p.value=S().getWeb3;const f=await p.value.eth.getChainId();Z[f].map(w=>{T.value.push(w.token)}),C.value=ne(oe(parseInt(f)))}const a=async()=>{if(b.value=!0,h.value=[],v.value){const f=await p.value.eth.getBalance(v.value);h.value.push({symbol:C.value.token,token:"",balance:j(f,p.value)});const w=T.value.map(async _=>{const n=D(z,_,p.value),s=await n.methods.symbol().call(),l=await n.methods.balanceOf(I().getWallet).call(),c={symbol:s,token:_,balance:j(l,p.value)};h.value.push(c)});await Promise.all(w)}b.value=!1};P(()=>{W(),a()});const E=f=>{A.value=!0,g.value=f},L=()=>{a()};return(f,w)=>{const _=u("el-table-column"),n=u("el-button"),s=u("el-table"),l=u("el-card"),c=ae("loading");return V(),$("div",null,[t(l,{shadow:"never"},{header:e(()=>[y("div",ie,[y("span",ue,k(m(r)("assets.assets")+" - "+v.value),1)])]),default:e(()=>[le((V(),B(s,{data:h.value,style:{width:"100%"}},{default:e(()=>[t(_,{label:m(r)("assets.asset")},{default:e(o=>[y("div",de,[ce,y("span",me,k(o.row.symbol),1)])]),_:1},8,["label"]),t(_,{label:m(r)("assets.balance")},{default:e(o=>[y("div",pe,[y("span",null,k(o.row.balance),1),y("span",ve,k(o.row.symbol),1)])]),_:1},8,["label"]),t(_,{label:m(r)("assets.operation")},{default:e(o=>[parseFloat(o.row.balance)>0?(V(),B(n,{key:0,type:"primary",size:"small",onClick:x=>E(o.row)},{default:e(()=>[F(k(m(r)("wallet.btnSend")),1)]),_:2},1032,["onClick"])):se("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[c,b.value]])]),_:1}),t(re,{visible:A.value,"onUpdate:visible":w[0]||(w[0]=o=>A.value=o),data:g.value,tokenList:h.value,onRefreshAssetList:L},null,8,["visible","data","tokenList"])])}}});export{Fe as default};
