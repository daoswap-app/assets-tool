import{E as n}from"./___vite-browser-external_commonjs-proxy-7f1f402a.js";import{u as E}from"./web3Modal-9b2051b7.js";import{c as Q,i as X}from"./addresses-b89466f9.js";import{u as T,W as Y}from"./Wallet_abi-d6b92ce6.js";import{g as F,M as Z,e as H,W as ee,T as te,w as $}from"./web3-bdfc4e9c.js";import{E as j}from"./ERC20_abi-801f43f8.js";import{x as N,r,o as z,w as O,a7 as u,y as V,H as R,I as t,P as e,M as I,O as A,u as v,z as P,a0 as ae,F as le,aa as se,A as k,J as oe,L as ne}from"./runtime-core.esm-bundler-c80a0204.js";import{i as re}from"./chains-68c757ba.js";import{B as ie}from"./ButtonOfCopy-7cfa85d9.js";import"./vue-i18n.runtime.esm-bundler-d653d868.js";import"./web3.min-bdec5e64.js";import"./index-2be9993c.js";import"./vue-router-935545c9.js";import"./utils-02cb188c.js";import"./message-f37bf65b.js";import"./index-136a525e.js";import"./_plugin-vue_export-helper-c27b6911.js";const ue=N({__name:"SendTransaction",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null},tokenList:{type:Object,default:()=>[]}},emits:["update:visible","refresh-asset-list"],setup(M,{emit:W}){const w=M,f=r(!1),d=r(!1),y=r(""),h=r(null),g=r(null),L={sendAddress:"",recipientAddress:"",assetToken:"",amount:""},C=r(),a=r(L);z(()=>{y.value=T().getWallet,h.value=E().getWallet,g.value=E().getWeb3,a.value.sendAddress=y.value});const x=(s,o,l)=>{o===""?l(new Error(n("transaction.please input recipient address"))):(a.value.recipientAddress=Q(a.value.recipientAddress),X(a.value.recipientAddress)?l():l(new Error(n("transaction.invalid recipient address"))))},S=(s,o,l)=>{o===""?l(new Error(n("transaction.please input amount"))):parseFloat(o)>parseFloat(w.data.balance)?l(new Error(n("transaction.exceed balance"))):l()},D=async()=>await C.value.validate(s=>!!s),_=async()=>{if(await D()){f.value=!0;const o=F(Z,T().getWallet,g.value),l={destination:a.value.recipientAddress,value:H(a.value.amount,g.value),data:"0x"};if(a.value.assetToken){const p=F(j,a.value.assetToken,g.value),b=H(a.value.amount,g.value),i=await p.methods.transfer(a.value.recipientAddress,b).encodeABI();l.destination=a.value.assetToken,l.value="0",l.data=i}o.methods.submitTransaction(l.destination,l.value,l.data).send({from:h.value.address}).then(()=>{W("refresh-asset-list")}).catch(p=>{console.error(p)}).finally(()=>{f.value=!1,m()})}},m=()=>{d.value=!1};return O(()=>d.value,s=>{W("update:visible",s)}),O(()=>w.visible,s=>{d.value=s}),O(()=>w.data,s=>{a.value.assetToken=s?s.token:""}),(s,o)=>{const l=u("el-col"),p=u("el-row"),b=u("el-form-item"),i=u("el-divider"),B=u("el-input"),q=u("el-option"),J=u("el-select"),K=u("el-form"),U=u("el-button"),G=u("el-dialog");return V(),R(G,{modelValue:d.value,"onUpdate:modelValue":o[3]||(o[3]=c=>d.value=c),title:v(n)("transaction.sendTokens"),width:"80%",draggable:"","close-on-click-modal":!1,"before-close":m},{footer:t(()=>[e(U,{loading:f.value,onClick:m},{default:t(()=>[I(A(v(n)("wallet.btnCancel")),1)]),_:1},8,["loading"]),e(U,{loading:f.value,type:"primary",onClick:_},{default:t(()=>[I(A(v(n)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:t(()=>[e(K,{ref_key:"transactionFormRef",ref:C,model:a.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0,"label-position":"top"},{default:t(()=>[e(b,{prop:"sendAddress",label:v(n)("transaction.sendAddress"),style:{width:"100%"}},{default:t(()=>[e(p,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[I(A(a.value.sendAddress),1)]),_:1})]),_:1})]),_:1},8,["label"]),e(i),e(b,{prop:"recipientAddress",label:v(n)("transaction.recipientAddress"),style:{width:"100%"},rules:[{validator:x,trigger:"blur"}]},{default:t(()=>[e(p,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[e(B,{modelValue:a.value.recipientAddress,"onUpdate:modelValue":o[0]||(o[0]=c=>a.value.recipientAddress=c)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),e(b,{prop:"assetToken",label:v(n)("transaction.assetToken"),style:{width:"100%"}},{default:t(()=>[e(p,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[e(J,{modelValue:a.value.assetToken,"onUpdate:modelValue":o[1]||(o[1]=c=>a.value.assetToken=c),style:{width:"100%"}},{default:t(()=>[(V(!0),P(le,null,ae(w.tokenList,c=>(V(),R(q,{key:c.token,label:c.symbol+(c.token?" - "+c.token:""),value:c.token},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label"]),e(b,{prop:"amount",label:v(n)("transaction.amount"),style:{width:"100%"},rules:[{validator:S,trigger:"blur"}]},{default:t(()=>[e(p,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[e(B,{modelValue:a.value.amount,"onUpdate:modelValue":o[2]||(o[2]=c=>a.value.amount=c)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),de={class:"card-header"},ce={class:"font-medium",style:{"word-wrap":"break-word"}},me={style:{display:"flex","align-items":"left"}},pe=k("i",{class:"el-icon-time"},null,-1),ve={style:{"margin-left":"10px"}},fe={style:{display:"flex","align-items":"left"}},_e={style:{"margin-left":"3px"}},be=N({name:"Assets"}),Se=N({...be,setup(M){const W=r([]),w=r(!1),f=r(null),d=r(null),y=r(null),h=r([]),g=r(!1),L=r(null),C=r(null);async function a(){d.value=T().getWallet,y.value=E().getWallet,f.value=E().getWeb3;try{const m=await F(Y,ee[y.value.chainId],f.value).methods.getWalletList().call({from:y.value.address});m.length>0?d.value||(T().setDefaultWallet(m[0].token),d.value=m[0].token):(T().removeDefaultWallet(),d.value=null)}catch{}W.value=[],te[y.value.chainId].map(_=>{W.value.push(_.token)}),C.value=re(y.value.chainId)}const x=async()=>{if(w.value=!0,h.value=[],d.value){const _=await f.value.eth.getBalance(d.value);h.value.push({symbol:C.value.token,token:"",balance:$(_,f.value)});const m=W.value.map(async s=>{const o=F(j,s,f.value),l=await o.methods.symbol().call(),p=await o.methods.balanceOf(T().getWallet).call(),b={symbol:l,token:s,balance:$(p,f.value)};h.value.filter(B=>B.token==s).length<=0&&h.value.push(b)});await Promise.all(m)}w.value=!1};z(()=>{a().then(()=>x())});const S=_=>{g.value=!0,L.value=_},D=()=>{x()};return E().$subscribe(()=>{a().then(()=>x())}),(_,m)=>{const s=u("el-table-column"),o=u("el-button"),l=u("el-table"),p=u("el-card"),b=se("loading");return V(),P("div",null,[e(p,{shadow:"never"},{header:t(()=>[k("div",de,[k("span",ce,[I(A(v(n)("assets.assets"))+" - ",1),e(ie,{text:d.value},null,8,["text"])])])]),default:t(()=>[oe((V(),R(l,{data:h.value,style:{width:"100%"}},{default:t(()=>[e(s,{label:v(n)("assets.asset")},{default:t(i=>[k("div",me,[pe,k("span",ve,A(i.row.symbol),1)])]),_:1},8,["label"]),e(s,{label:v(n)("assets.balance")},{default:t(i=>[k("div",fe,[k("span",null,A(i.row.balance),1),k("span",_e,A(i.row.symbol),1)])]),_:1},8,["label"]),e(s,{label:v(n)("assets.operation")},{default:t(i=>[parseFloat(i.row.balance)>0?(V(),R(o,{key:0,type:"primary",size:"small",onClick:B=>S(i.row)},{default:t(()=>[I(A(v(n)("wallet.btnSend")),1)]),_:2},1032,["onClick"])):ne("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[b,w.value]])]),_:1}),e(ue,{visible:g.value,"onUpdate:visible":m[0]||(m[0]=i=>g.value=i),data:L.value,tokenList:h.value,onRefreshAssetList:D},null,8,["visible","data","tokenList"])])}}});export{Se as default};
