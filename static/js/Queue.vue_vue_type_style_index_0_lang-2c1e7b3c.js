import{E as r}from"./___vite-browser-external_commonjs-proxy-eabcf697.js";import{A as X}from"./arrow-down-s-line-da487a0d.js";import{M as B,g as L,E as Y,w as A,T as Z}from"./web3-5746e9c3.js";import{E as tt}from"./ERC20_abi-801f43f8.js";import{I as P,p as et,c as M}from"./index-7ea0abad.js";import{B as at}from"./ButtonOfCopy-b4d19cd5.js";import{i as nt,j as ot}from"./index-997097ac.js";import{x as Q,r as V,o as lt,a7 as m,aa as st,y as i,z as j,J as rt,H as _,I as n,P as f,A as p,M as d,O as l,u as s,F as ct,a0 as it,L as h}from"./runtime-core.esm-bundler-c80a0204.js";const dt={style:{"word-wrap":"break-word"}},ut={class:"block"},mt={style:{"word-wrap":"break-word"}},_t={style:{"word-wrap":"break-word"}},ft={style:{display:"flex","align-items":"left"}},pt={style:{display:"flex","align-items":"left"}},wt={style:{"margin-left":"3px"}},vt=Q({name:"TransactionsQueue"}),Tt=Q({...vt,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup($){const t=$,z=new P(tt),J=new P(B),w=V(!1),E=V([]),F=V(null),H=V(0),W=async()=>{w.value=!0;const u=L(B,t.currentWallet,t.web3);H.value=Y[t.connectedWallet.chainId],E.value=[];const N=await u.methods.getTransactionIds(0).call(),v=await u.getPastEvents("allEvents",{filter:{transactionId:N},fromBlock:H.value,toBlock:"latest"}),k=N.map(async C=>{const c=await u.methods.getTransaction(C).call(),O=await u.methods.getTransactionConfirmationStatus(C,t.connectedWallet.address).call(),b=await t.web3.eth.getChainId();F.value=nt(ot(parseInt(b)));let I=1,g="",T="",S=c.to,x=null,D=null;if(c.to.toLowerCase()===t.currentWallet.toLowerCase()){I=2;const o=c.data?J.decodeData(c.data):null;o&&(g=o.method)}else{I=1;const o=c.data?z.decodeData(c.data):null;if(T=F.value.token,x=A(c.value,t.web3),o){const y=Z[b].filter(R=>R.token.toLowerCase()===c.to.toLowerCase());g=o.method,T=y.length>0?y[0].symbol:F.value.token,S=o.inputs[0],x=A(new t.web3.utils.toBN(o.inputs[1].toString()),t.web3),D={to:o.inputs[0],value:A(new t.web3.utils.toBN(o.inputs[1].toString()),t.web3)}}}const e={id:C,destination:S,tokenSymbol:T,value:x,data:D,confirmations:c.confirmations,revokes:c.revokes,executeState:c.state,confirmStatus:O,type:I,methodName:g,events:[]},a=await v.filter(o=>{if(o.returnValues.transactionId&&o.returnValues.transactionId==C)return o});if(a.length>0){const o=a.map(async y=>{const R=await t.web3.eth.getTransaction(y.transactionHash),U={eventName:y.event,...y.returnValues,transactionHash:y.transactionHash,blockNumber:y.blockNumber,from:R.from,createTime:et(y.returnValues.createTime)};e.events.push(U)});await Promise.all(o),e.events.sort(M("blockNumber"))}E.value.push(e)});await Promise.all(k),E.value.sort(M("id")),w.value=!1};lt(()=>{t.connectedWallet&&t.web3&&t.currentWallet&&W()});const K=u=>{w.value=!0,L(B,t.currentWallet,t.web3).methods.confirmTransaction(u.id).send({from:t.connectedWallet.address}).then(async()=>{await W()}).catch(v=>{console.error(v)}).finally(()=>{w.value=!1})},q=u=>{w.value=!0,L(B,t.currentWallet,t.web3).methods.executeTransaction(u.id).send({from:t.connectedWallet.address}).then(async()=>{await W()}).catch(v=>{console.error(v)}).finally(()=>{w.value=!1})},G=u=>{w.value=!0,L(B,t.currentWallet,t.web3).methods.revokeTransaction(u.id).send({from:t.connectedWallet.address}).then(async()=>{await W()}).catch(v=>{console.error(v)}).finally(()=>{w.value=!1})};return(u,N)=>{const v=m("el-divider"),k=m("el-tag"),C=m("el-card"),c=m("el-timeline-item"),O=m("el-timeline"),b=m("el-table-column"),I=m("IconifyIconOffline"),g=m("el-dropdown-item"),T=m("el-dropdown-menu"),S=m("el-dropdown"),x=m("el-table"),D=st("loading");return i(),j("div",null,[rt((i(),_(x,{data:E.value,style:{width:"100%"}},{default:n(()=>[f(b,{type:"expand"},{default:n(e=>[p("p",dt,[d(l(s(r)("transaction.destination"))+": ",1),f(at,{text:e.row.destination},null,8,["text"])]),f(v),p("div",ut,[e.row.events.length>0?(i(),_(O,{key:0},{default:n(()=>[(i(!0),j(ct,null,it(e.row.events,(a,o)=>(i(),_(c,{key:o,timestamp:a.createTime,placement:"top"},{default:n(()=>[f(C,null,{default:n(()=>[p("h4",null,[d(l(s(r)("transaction.eventName"))+": ",1),a.eventName=="TransactionCreated"?(i(),_(k,{key:0,type:"warning"},{default:n(()=>[d(l(a.eventName?s(r)("transaction."+a.eventName):""),1)]),_:2},1024)):h("",!0),a.eventName=="TransactionConfirmed"?(i(),_(k,{key:1,type:"success"},{default:n(()=>[d(l(a.eventName?s(r)("transaction."+a.eventName):""),1)]),_:2},1024)):h("",!0),a.eventName=="TransactionRevoke"?(i(),_(k,{key:2,type:"danger"},{default:n(()=>[d(l(a.eventName?s(r)("transaction."+a.eventName):""),1)]),_:2},1024)):h("",!0),a.eventName=="TransactionExecuted"?(i(),_(k,{key:3},{default:n(()=>[d(l(a.eventName?s(r)("transaction."+a.eventName):""),1)]),_:2},1024)):h("",!0)]),p("p",mt,[d(l(s(r)("transaction.eventFrom"))+": ",1),p("span",null,l(a.from),1)]),p("p",_t,[d(l(s(r)("transaction.eventTransactionHash"))+": ",1),p("span",null,l(a.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):h("",!0)])]),_:1}),f(b,{label:s(r)("transaction.type")},{default:n(e=>[p("div",ft,[e.row.type==1?(i(),_(k,{key:0,type:"success"},{default:n(()=>[d(l(s(r)("transaction."+e.row.methodName)),1)]),_:2},1024)):h("",!0),e.row.type==2?(i(),_(k,{key:1,type:"warning"},{default:n(()=>[d(l(s(r)("transaction."+e.row.methodName)),1)]),_:2},1024)):h("",!0)])]),_:1},8,["label"]),f(b,{label:s(r)("transaction.value")},{default:n(e=>[p("div",pt,[p("span",null,l(e.row.value),1),p("span",wt,l(e.row.tokenSymbol),1)])]),_:1},8,["label"]),f(b,{label:s(r)("assets.operation")},{default:n(e=>[f(S,{trigger:"click"},{dropdown:n(()=>[f(T,null,{default:n(()=>[e.row.confirmStatus?h("",!0):(i(),_(g,{key:0,onClick:a=>K(e.row)},{default:n(()=>[d(l(s(r)("transaction.btnConfirm")),1)]),_:2},1032,["onClick"])),e.row.confirmStatus?h("",!0):(i(),_(g,{key:1,onClick:a=>G(e.row)},{default:n(()=>[d(l(s(r)("transaction.btnRevoke")),1)]),_:2},1032,["onClick"])),f(g,{onClick:a=>q(e.row),divided:""},{default:n(()=>[d(l(s(r)("transaction.btnExecute")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[f(I,{icon:s(X),class:"text-[24px]"},null,8,["icon"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[D,w.value]])])}}});export{Tt as _};
