import{t as r}from"./i18n-4a0f4af2.js";import{u as S}from"./web3Modal-4ce521cd.js";import{f as H}from"./formatters-18bf6b7d.js";import{c as Q,i as X}from"./addresses-acfad7e8.js";import{u as x}from"./wallet-9d9b6135.js";import{M as Y}from"./MultiSigWallet_abi-6912cb8d.js";import{E as z}from"./ERC20_abi-801f43f8.js";import{g as D,e as j}from"./web3-dfdb1234.js";import{x as N,r as u,o as P,w as I,a7 as i,y as T,H as F,I as e,P as t,M as B,O as y,u as c,z as $,a0 as Z,F as ee,aa as te,A as w,J as ae,L as le}from"./runtime-core.esm-bundler-c80a0204.js";import{T as se}from"./constants-b9202782.js";import"./vue-i18n.runtime.esm-bundler-d653d868.js";import"./web3.min-16c48c0e.js";import"./index-51c58d4e.js";import"./vue-router-935545c9.js";import"./___vite-browser-external_commonjs-proxy-e8043f7a.js";import"./utils-47c995b4.js";import"./index-b5479df7.js";const oe=N({__name:"SendTransaction",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null},tokenList:{type:Object,default:()=>[]}},emits:["update:visible","refresh-asset-list"],setup(M,{emit:W}){const f=M,m=u(!1),_=u(!1),v=u(""),A=u(null),b=u(null),E={sendAddress:"",recipientAddress:"",assetToken:"",amount:""},C=u(),l=u(E);P(()=>{v.value=x().getWallet,A.value=S().getWallet,b.value=S().getWeb3,l.value.sendAddress=v.value});const L=(n,o,a)=>{o===""?a(new Error(r("transaction.please input recipient address"))):(l.value.recipientAddress=Q(l.value.recipientAddress),X(l.value.recipientAddress)?a():a(new Error(r("transaction.invalid recipient address"))))},g=(n,o,a)=>{o===""?a(new Error(r("transaction.please input amount"))):parseFloat(o)>parseFloat(f.data.balance)?a(new Error(r("transaction.exceed balance"))):a()},V=async()=>await C.value.validate(n=>!!n),h=async()=>{if(await V()){m.value=!0;const o=D(Y,x().getWallet,b.value),a={destination:l.value.recipientAddress,value:j(l.value.amount,b.value),data:"0x"};if(l.value.assetToken){const s=D(z,l.value.assetToken,b.value),k=j(l.value.amount,b.value),R=await s.methods.transfer(l.value.recipientAddress,k).encodeABI();a.destination=l.value.assetToken,a.value="0",a.data=R}o.methods.submitTransaction(a.destination,a.value,a.data).send({from:A.value.address}).then(()=>{W("refresh-asset-list")}).catch(s=>{console.error(s)}).finally(()=>{m.value=!1,p()})}},p=()=>{_.value=!1};return I(()=>_.value,n=>{W("update:visible",n)}),I(()=>f.visible,n=>{_.value=n}),I(()=>f.data,n=>{l.value.assetToken=n?n.token:""}),(n,o)=>{const a=i("el-col"),s=i("el-row"),k=i("el-form-item"),R=i("el-divider"),O=i("el-input"),q=i("el-option"),J=i("el-select"),K=i("el-form"),U=i("el-button"),G=i("el-dialog");return T(),F(G,{modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=d=>_.value=d),title:c(r)("transaction.sendTokens"),width:"80%",draggable:"","close-on-click-modal":!1,"before-close":p},{footer:e(()=>[t(U,{loading:m.value,onClick:p},{default:e(()=>[B(y(c(r)("wallet.btnCancel")),1)]),_:1},8,["loading"]),t(U,{loading:m.value,type:"primary",onClick:h},{default:e(()=>[B(y(c(r)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:e(()=>[t(K,{ref_key:"transactionFormRef",ref:C,model:l.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:e(()=>[t(k,{prop:"sendAddress",label:c(r)("transaction.sendAddress"),style:{width:"100%"}},{default:e(()=>[t(s,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(a,{span:24},{default:e(()=>[B(y(l.value.sendAddress),1)]),_:1})]),_:1})]),_:1},8,["label"]),t(R),t(k,{prop:"recipientAddress",label:c(r)("transaction.recipientAddress"),style:{width:"100%"},rules:[{validator:L,trigger:"blur"}]},{default:e(()=>[t(s,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(a,{span:24},{default:e(()=>[t(O,{modelValue:l.value.recipientAddress,"onUpdate:modelValue":o[0]||(o[0]=d=>l.value.recipientAddress=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),t(k,{prop:"assetToken",label:c(r)("transaction.assetToken"),style:{width:"100%"}},{default:e(()=>[t(s,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(a,{span:24},{default:e(()=>[t(J,{modelValue:l.value.assetToken,"onUpdate:modelValue":o[1]||(o[1]=d=>l.value.assetToken=d),style:{width:"100%"}},{default:e(()=>[(T(!0),$(ee,null,Z(f.tokenList,d=>(T(),F(q,{key:d.token,label:d.symbol+(d.token?" - "+d.token:""),value:d.token},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label"]),t(k,{prop:"amount",label:c(r)("transaction.amount"),style:{width:"100%"},rules:[{validator:g,trigger:"blur"}]},{default:e(()=>[t(s,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(a,{span:24},{default:e(()=>[t(O,{modelValue:l.value.amount,"onUpdate:modelValue":o[2]||(o[2]=d=>l.value.amount=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ne={class:"card-header"},re={class:"font-medium"},ie={style:{display:"flex","align-items":"left"}},ue=w("i",{class:"el-icon-time"},null,-1),de={style:{"margin-left":"10px"}},ce={style:{display:"flex","align-items":"left"}},me={style:{"margin-left":"3px"}},pe=N({name:"Assets"}),Ee=N({...pe,setup(M){const W=u([]),f=u(!1),m=u(null),_=u(null),v=u([]),A=u(!1),b=u(null);async function E(){_.value=x().getWallet,m.value=S().getWeb3;const g=await m.value.eth.getChainId();W.value=se[g]}const C=async()=>{f.value=!0,v.value=[];const g=await m.value.eth.getBalance(x().getWallet);v.value.push({symbol:"BNB",token:"",balance:H(g,18)});const V=W.value.map(async h=>{const p=D(z,h,m.value),n=await p.methods.symbol().call(),o=await p.methods.decimals().call(),a=await p.methods.balanceOf(x().getWallet).call(),s={symbol:n,token:h,balance:H(a,o)};v.value.push(s)});await Promise.all(V),f.value=!1};P(()=>{E(),C()});const l=g=>{A.value=!0,b.value=g},L=()=>{C()};return(g,V)=>{const h=i("el-table-column"),p=i("el-button"),n=i("el-table"),o=i("el-card"),a=te("loading");return T(),$("div",null,[t(o,{shadow:"never"},{header:e(()=>[w("div",ne,[w("span",re,y(c(r)("assets.assets")+" - "+_.value),1)])]),default:e(()=>[ae((T(),F(n,{data:v.value,style:{width:"100%"}},{default:e(()=>[t(h,{label:c(r)("assets.asset")},{default:e(s=>[w("div",ie,[ue,w("span",de,y(s.row.symbol),1)])]),_:1},8,["label"]),t(h,{label:c(r)("assets.balance")},{default:e(s=>[w("div",ce,[w("span",null,y(s.row.balance),1),w("span",me,y(s.row.symbol),1)])]),_:1},8,["label"]),t(h,{label:c(r)("assets.operation")},{default:e(s=>[s.row.balance>0?(T(),F(p,{key:0,type:"primary",size:"small",onClick:k=>l(s.row)},{default:e(()=>[B(y(c(r)("wallet.btnSend")),1)]),_:2},1032,["onClick"])):le("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[a,f.value]])]),_:1}),t(oe,{visible:A.value,"onUpdate:visible":V[0]||(V[0]=s=>A.value=s),data:b.value,tokenList:v.value,onRefreshAssetList:L},null,8,["visible","data","tokenList"])])}}});export{Ee as default};
