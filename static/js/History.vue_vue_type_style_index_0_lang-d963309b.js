import{E as o}from"./___vite-browser-external_commonjs-proxy-7f1f402a.js";import{g as Q,M as q,E as G,b as K,a as H}from"./web3-62625531.js";import{d as U,a as X,p as Y,c as M}from"./decodeParams-f5fdd745.js";import{B as Z}from"./ButtonOfCopy-9be7905e.js";import{i as $}from"./chains-85289d49.js";import{x as O,r as b,o as tt,a7 as _,aa as et,y as s,z as k,J as at,H as p,I as l,P as f,A as i,M as u,O as e,u as a,F as P,a0 as L,L as w}from"./runtime-core.esm-bundler-c80a0204.js";const nt={style:{"word-wrap":"break-word"}},ot={key:0},st={key:1},rt={style:{"word-wrap":"break-word"}},lt={class:"block"},ct={style:{"word-wrap":"break-word"}},it={style:{"word-wrap":"break-word"}},ut={style:{display:"flex","align-items":"left"}},dt={style:{display:"flex","align-items":"left"}},mt=O({name:"TransactionsHistory"}),ht=O({...mt,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup(A){const r=A,N=b(!1),I=b([]),W=b(null),T=b(0),V=b(0),R=b(0),j=async()=>{N.value=!0;const y=Q(q,r.currentWallet,r.web3);T.value=G[r.connectedWallet.chainId],V.value=await r.web3.eth.getBlockNumber(),R.value=Math.ceil((V.value-T.value)/K),I.value=[];const D=await y.methods.getTransactionIds(1).call(),x=await y.methods.getTransactionIds(2).call(),d=D.concat(x),B=await y.getPastEvents("allEvents",{filter:{transactionId:d},fromBlock:T.value,toBlock:"latest"}),C=d.map(async v=>{const c=await y.methods.getTransaction(v).call(),S=await y.methods.getTransactionConfirmationStatus(v,r.connectedWallet.address).call(),E=await r.web3.eth.getChainId();W.value=$(E);const t={id:v,destination:c.to,tokenSymbol:"",value:null,data:null,confirmations:c.confirmations,revokes:c.revokes,executeState:c.state,confirmStatus:S,type:1,methodName:"",events:[]};let n=null;c.to.toLowerCase()===r.currentWallet.toLowerCase()?n=U(c):n=X(c,W,r.web3);const m={...t,...n},F=await B.filter(g=>{if(g.returnValues.transactionId&&g.returnValues.transactionId==v)return g});if(F.length>0){const g=F.map(async h=>{const z=await r.web3.eth.getTransaction(h.transactionHash),J={eventName:h.event,...h.returnValues,transactionHash:h.transactionHash,blockNumber:h.blockNumber,from:z.from,createTime:Y(h.returnValues.createTime)};m.events.push(J)});await Promise.all(g),m.events.sort(M("blockNumber"))}I.value.push(m)});await Promise.all(C),I.value.sort(M("id")),N.value=!1};return tt(()=>{r.connectedWallet&&r.web3&&r.currentWallet&&j()}),(y,D)=>{const x=_("el-divider"),d=_("el-tag"),B=_("el-card"),C=_("el-timeline-item"),v=_("el-timeline"),c=_("el-table-column"),S=_("el-table"),E=et("loading");return s(),k("div",null,[at((s(),p(S,{data:I.value,style:{width:"100%"}},{default:l(()=>[f(c,{type:"expand"},{default:l(t=>[i("p",nt,[u(e(a(o)("transaction.destination"))+": ",1),f(Z,{text:t.row.destination},null,8,["text"])]),t.row.type==2?(s(),k("div",ot,[(s(!0),k(P,null,L(t.row.data,(n,m)=>(s(),k("p",{style:{"word-wrap":"break-word"},key:m},e(a(o)("transaction."+n.name))+": "+e(n.value),1))),128))])):w("",!0),t.row.type==1?(s(),k("div",st,[i("p",rt,e(a(o)("transaction.amount"))+": "+e(t.row.value)+" "+e(t.row.tokenSymbol),1)])):w("",!0),f(x),i("div",lt,[t.row.events.length>0?(s(),p(v,{key:0},{default:l(()=>[(s(!0),k(P,null,L(t.row.events,(n,m)=>(s(),p(C,{key:m,timestamp:n.createTime,placement:"top"},{default:l(()=>[f(B,null,{default:l(()=>[i("h4",null,[u(e(a(o)("transaction.eventName"))+": ",1),f(d,{type:a(H)[n.eventName].tagType},{default:l(()=>[u(e(a(H)[n.eventName].name?a(o)("transaction."+a(H)[n.eventName].name):""),1)]),_:2},1032,["type"])]),i("p",ct,[u(e(a(o)("transaction.eventFrom"))+": ",1),i("span",null,e(n.from),1)]),i("p",it,[u(e(a(o)("transaction.eventTransactionHash"))+": ",1),i("span",null,e(n.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):w("",!0)])]),_:1}),f(c,{label:a(o)("transaction.type")},{default:l(t=>[i("div",ut,[t.row.type==1?(s(),p(d,{key:0,type:"success"},{default:l(()=>[u(e(a(o)("transaction."+t.row.methodName)),1)]),_:2},1024)):w("",!0),t.row.type==2?(s(),p(d,{key:1,type:"warning"},{default:l(()=>[u(e(a(o)("transaction."+t.row.methodName)),1)]),_:2},1024)):w("",!0)])]),_:1},8,["label"]),f(c,{label:a(o)("transaction.status")},{default:l(t=>[i("div",dt,[t.row.executeState==1?(s(),p(d,{key:0,type:"success"},{default:l(()=>[u(e(a(o)("transaction.statusSuccess")),1)]),_:1})):w("",!0),t.row.executeState==2?(s(),p(d,{key:1,type:"danger"},{default:l(()=>[u(e(a(o)("transaction.statusRevoke")),1)]),_:1})):w("",!0)])]),_:1},8,["label"])]),_:1},8,["data"])),[[E,N.value]])])}}});export{ht as _};
