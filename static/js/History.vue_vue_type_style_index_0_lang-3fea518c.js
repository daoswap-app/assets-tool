import{t as s}from"./___vite-browser-external_commonjs-proxy-1cc6769e.js";import{M as j,g as nt,E as ot,a as W,w as H,T as st}from"./web3-5a596777.js";import{E as lt}from"./ERC20_abi-801f43f8.js";import{I as z,p as rt,c as J}from"./index-a562c762.js";import{g as ct,h as it}from"./chains-db497463.js";import{x as K,r as w,o as dt,a7 as L,aa as ut,y,z as mt,J as ft,H as b,I as a,P as d,u as l,A as n,O as c,M as g,L as k}from"./runtime-core.esm-bundler-c80a0204.js";const vt={style:{display:"flex","align-items":"left"}},_t={style:{display:"flex","align-items":"left"}},pt={style:{display:"flex","align-items":"left"}},wt={style:{display:"flex","align-items":"left"}},yt={style:{display:"flex","align-items":"left"}},bt={style:{display:"flex","align-items":"left"}},ht={style:{display:"flex","align-items":"left"}},gt={style:{"margin-left":"3px"}},kt={style:{display:"flex","align-items":"left"}},It=K({name:"TransactionsHistory"}),St=K({...It,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup(Q){const e=Q,q=new z(lt),G=new z(j),I=w(!1),h=w([]),T=w(null),x=w(0),O=w(0),R=w(0),U=async()=>{I.value=!0;const u=nt(j,e.currentWallet,e.web3);x.value=ot[e.connectedWallet.chainId],O.value=await e.web3.eth.getBlockNumber(),R.value=Math.ceil((O.value-x.value)/W),h.value=[];const M=await u.methods.getTransactionIds(1).call(),r=await u.methods.getTransactionIds(2).call(),v=M.concat(r).map(async m=>{const t=await u.methods.getTransaction(m).call(),i=await u.methods.getTransactionConfirmationStatus(m,e.connectedWallet.address).call(),P=await e.web3.eth.getChainId();T.value=ct(it(parseInt(P)));let B=1,N="",E="",V=t.to,S=null,F=null;if(t.to.toLowerCase()===e.currentWallet.toLowerCase()){B=2;const o=t.data?G.decodeData(t.data):null;o&&(N=o.method)}else{B=1;const o=t.data?q.decodeData(t.data):null;if(E=T.value.token,S=H(t.value,e.web3),o){const f=st[P].filter(_=>_.token.toLowerCase()===t.to.toLowerCase());N=o.method,E=f.length>0?f[0].symbol:T.value.token,V=o.inputs[0],S=H(new e.web3.utils.toBN(o.inputs[1].toString()),e.web3),F={to:o.inputs[0],value:H(new e.web3.utils.toBN(o.inputs[1].toString()),e.web3)}}}const D={id:m,destination:V,tokenSymbol:E,value:S,data:F,confirmations:t.confirmations,revokes:t.revokes,executeState:t.state,confirmStatus:i,type:B,methodName:N,events:[]};for(let o=0;o<R.value;o++){const f=x.value+W*o,_=f+(W-1),X=await u.getPastEvents("TransactionCreated",{filter:{transactionId:m},fromBlock:f,toBlock:_}),Y=await u.getPastEvents("TransactionConfirmed",{filter:{transactionId:m},fromBlock:f,toBlock:_}),Z=await u.getPastEvents("TransactionRevoke",{filter:{transactionId:m},fromBlock:f,toBlock:_}),$=await u.getPastEvents("TransactionExecuted",{filter:{transactionId:m},fromBlock:f,toBlock:_}),A=X.concat(Y,Z,$);if(A.length>0){const tt=A.map(async p=>{const et=await e.web3.eth.getTransaction(p.transactionHash),at={eventName:p.event,...p.returnValues,transactionHash:p.transactionHash,blockNumber:p.blockNumber,from:et.from,createTime:rt(p.returnValues.createTime)};D.events.push(at)});await Promise.all(tt),D.events.sort(J("blockNumber"))}}h.value.push(D)});await Promise.all(v),h.value.sort(J("id")),I.value=!1};return dt(()=>{e.connectedWallet&&e.web3&&e.currentWallet&&U()}),(u,M)=>{const r=L("el-table-column"),C=L("el-table"),v=L("el-tag"),m=ut("loading");return y(),mt("div",null,[ft((y(),b(C,{data:h.value,style:{width:"100%"}},{default:a(()=>[d(r,{type:"expand"},{default:a(t=>[d(C,{data:t.row.events,style:{width:"100%"}},{default:a(()=>[d(r,{label:l(s)("transaction.eventName")},{default:a(i=>[n("div",vt,[n("span",null,c(i.row.eventName?l(s)("transaction."+i.row.eventName):""),1)])]),_:1},8,["label"]),d(r,{label:l(s)("transaction.eventFrom")},{default:a(i=>[n("div",_t,[n("span",null,c(i.row.from),1)])]),_:1},8,["label"]),d(r,{label:l(s)("transaction.eventTransactionHash")},{default:a(i=>[n("div",pt,[n("span",null,c(i.row.transactionHash),1)])]),_:1},8,["label"]),d(r,{label:l(s)("transaction.eventCreateTime")},{default:a(i=>[n("div",wt,[n("span",null,c(i.row.createTime),1)])]),_:1},8,["label"])]),_:2},1032,["data"])]),_:1}),d(r,{label:l(s)("transaction.type")},{default:a(t=>[n("div",yt,[t.row.type==1?(y(),b(v,{key:0,type:"success"},{default:a(()=>[g(c(l(s)("transaction."+t.row.methodName)),1)]),_:2},1024)):k("",!0),t.row.type==2?(y(),b(v,{key:1,type:"warning"},{default:a(()=>[g(c(l(s)("transaction."+t.row.methodName)),1)]),_:2},1024)):k("",!0)])]),_:1},8,["label"]),d(r,{label:l(s)("transaction.destination")},{default:a(t=>[n("div",bt,[n("span",null,c(t.row.destination),1)])]),_:1},8,["label"]),d(r,{label:l(s)("transaction.value")},{default:a(t=>[n("div",ht,[n("span",null,c(t.row.value),1),n("span",gt,c(t.row.tokenSymbol),1)])]),_:1},8,["label"]),d(r,{label:l(s)("transaction.status")},{default:a(t=>[n("div",kt,[t.row.executeState==1?(y(),b(v,{key:0,type:"success"},{default:a(()=>[g(c(l(s)("transaction.statusSuccess")),1)]),_:1})):k("",!0),t.row.executeState==2?(y(),b(v,{key:1,type:"danger"},{default:a(()=>[g(c(l(s)("transaction.statusRevoke")),1)]),_:1})):k("",!0)])]),_:1},8,["label"])]),_:1},8,["data"])),[[m,I.value]])])}}});export{St as _};
