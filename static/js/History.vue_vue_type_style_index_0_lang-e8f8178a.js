import{E as r}from"./___vite-browser-external_commonjs-proxy-eabcf697.js";import{M as O,g as Y,E as Z,a as $,w as L,T as tt}from"./web3-7e9ba0b7.js";import{E as et}from"./ERC20_abi-801f43f8.js";import{I as P,p as at,c as j}from"./index-7ea0abad.js";import{B as nt}from"./ButtonOfCopy-b4d19cd5.js";import{i as ot,j as st}from"./index-997097ac.js";import{x as J,r as b,o as lt,a7 as w,aa as rt,y as i,z,J as ct,H as _,I as o,P as v,A as u,M as d,O as s,u as c,F as it,a0 as ut,L as f}from"./runtime-core.esm-bundler-c80a0204.js";const dt={style:{"word-wrap":"break-word"}},mt={class:"block"},_t={style:{"word-wrap":"break-word"}},pt={style:{"word-wrap":"break-word"}},ft={style:{display:"flex","align-items":"left"}},wt={style:{display:"flex","align-items":"left"}},vt={style:{"margin-left":"3px"}},yt={style:{display:"flex","align-items":"left"}},ht=J({name:"TransactionsHistory"}),Ct=J({...ht,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup(K){const a=K,Q=new P(et),q=new P(O),I=b(!1),g=b([]),T=b(null),x=b(0),V=b(0),G=b(0),U=async()=>{I.value=!0;const y=Y(O,a.currentWallet,a.web3);x.value=Z[a.connectedWallet.chainId],V.value=await a.web3.eth.getBlockNumber(),G.value=Math.ceil((V.value-x.value)/$),g.value=[];const F=await y.methods.getTransactionIds(1).call(),C=await y.methods.getTransactionIds(2).call(),m=F.concat(C),B=await y.getPastEvents("allEvents",{filter:{transactionId:m},fromBlock:x.value,toBlock:"latest"}),E=m.map(async h=>{const n=await y.methods.getTransaction(h).call(),S=await y.methods.getTransactionConfirmationStatus(h,a.connectedWallet.address).call(),N=await a.web3.eth.getChainId();T.value=ot(st(parseInt(N)));let e=1,t="",k="",M=n.to,D=null,R=null;if(n.to.toLowerCase()===a.currentWallet.toLowerCase()){e=2;const l=n.data?q.decodeData(n.data):null;l&&(t=l.method)}else{e=1;const l=n.data?Q.decodeData(n.data):null;if(k=T.value.token,D=L(n.value,a.web3),l){const p=tt[N].filter(H=>H.token.toLowerCase()===n.to.toLowerCase());t=l.method,k=p.length>0?p[0].symbol:T.value.token,M=l.inputs[0],D=L(new a.web3.utils.toBN(l.inputs[1].toString()),a.web3),R={to:l.inputs[0],value:L(new a.web3.utils.toBN(l.inputs[1].toString()),a.web3)}}}const W={id:h,destination:M,tokenSymbol:k,value:D,data:R,confirmations:n.confirmations,revokes:n.revokes,executeState:n.state,confirmStatus:S,type:e,methodName:t,events:[]},A=await B.filter(l=>{if(l.returnValues.transactionId&&l.returnValues.transactionId==h)return l});if(A.length>0){const l=A.map(async p=>{const H=await a.web3.eth.getTransaction(p.transactionHash),X={eventName:p.event,...p.returnValues,transactionHash:p.transactionHash,blockNumber:p.blockNumber,from:H.from,createTime:at(p.returnValues.createTime)};W.events.push(X)});await Promise.all(l),W.events.sort(j("blockNumber"))}g.value.push(W)});await Promise.all(E),g.value.sort(j("id")),I.value=!1};return lt(()=>{a.connectedWallet&&a.web3&&a.currentWallet&&U()}),(y,F)=>{const C=w("el-divider"),m=w("el-tag"),B=w("el-card"),E=w("el-timeline-item"),h=w("el-timeline"),n=w("el-table-column"),S=w("el-table"),N=rt("loading");return i(),z("div",null,[ct((i(),_(S,{data:g.value,style:{width:"100%"}},{default:o(()=>[v(n,{type:"expand"},{default:o(e=>[u("p",dt,[d(s(c(r)("transaction.destination"))+": ",1),v(nt,{text:e.row.destination},null,8,["text"])]),v(C),u("div",mt,[e.row.events.length>0?(i(),_(h,{key:0},{default:o(()=>[(i(!0),z(it,null,ut(e.row.events,(t,k)=>(i(),_(E,{key:k,timestamp:t.createTime,placement:"top"},{default:o(()=>[v(B,null,{default:o(()=>[u("h4",null,[d(s(c(r)("transaction.eventName"))+": ",1),t.eventName=="TransactionCreated"?(i(),_(m,{key:0,type:"warning"},{default:o(()=>[d(s(t.eventName?c(r)("transaction."+t.eventName):""),1)]),_:2},1024)):f("",!0),t.eventName=="TransactionConfirmed"?(i(),_(m,{key:1,type:"success"},{default:o(()=>[d(s(t.eventName?c(r)("transaction."+t.eventName):""),1)]),_:2},1024)):f("",!0),t.eventName=="TransactionRevoke"?(i(),_(m,{key:2,type:"danger"},{default:o(()=>[d(s(t.eventName?c(r)("transaction."+t.eventName):""),1)]),_:2},1024)):f("",!0),t.eventName=="TransactionExecuted"?(i(),_(m,{key:3},{default:o(()=>[d(s(t.eventName?c(r)("transaction."+t.eventName):""),1)]),_:2},1024)):f("",!0)]),u("p",_t,[d(s(c(r)("transaction.eventFrom"))+": ",1),u("span",null,s(t.from),1)]),u("p",pt,[d(s(c(r)("transaction.eventTransactionHash"))+": ",1),u("span",null,s(t.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):f("",!0)])]),_:1}),v(n,{label:c(r)("transaction.type")},{default:o(e=>[u("div",ft,[e.row.type==1?(i(),_(m,{key:0,type:"success"},{default:o(()=>[d(s(c(r)("transaction."+e.row.methodName)),1)]),_:2},1024)):f("",!0),e.row.type==2?(i(),_(m,{key:1,type:"warning"},{default:o(()=>[d(s(c(r)("transaction."+e.row.methodName)),1)]),_:2},1024)):f("",!0)])]),_:1},8,["label"]),v(n,{label:c(r)("transaction.value")},{default:o(e=>[u("div",wt,[u("span",null,s(e.row.value),1),u("span",vt,s(e.row.tokenSymbol),1)])]),_:1},8,["label"]),v(n,{label:c(r)("transaction.status")},{default:o(e=>[u("div",yt,[e.row.executeState==1?(i(),_(m,{key:0,type:"success"},{default:o(()=>[d(s(c(r)("transaction.statusSuccess")),1)]),_:1})):f("",!0),e.row.executeState==2?(i(),_(m,{key:1,type:"danger"},{default:o(()=>[d(s(c(r)("transaction.statusRevoke")),1)]),_:1})):f("",!0)])]),_:1},8,["label"])]),_:1},8,["data"])),[[N,I.value]])])}}});export{Ct as _};
