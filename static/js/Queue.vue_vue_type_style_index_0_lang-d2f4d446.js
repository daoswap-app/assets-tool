import{t as l}from"./___vite-browser-external_commonjs-proxy-4a27f4fc.js";import{A as se}from"./arrow-down-s-line-da487a0d.js";import{M as x,g as F,E as le,a as M,w as V,T as re}from"./web3-ad2cfba4.js";import{E as ce}from"./ERC20_abi-801f43f8.js";import{I as $,p as ie,c as j}from"./index-ff07874e.js";import{g as de,h as ue}from"./index-a9568fb4.js";import{x as J,r as C,o as me,a7 as m,aa as fe,y as d,z,J as _e,H as f,I as n,P as w,A as _,O as o,u as s,F as we,a0 as pe,L as h,M as u}from"./runtime-core.esm-bundler-c80a0204.js";const ve={style:{"word-wrap":"break-word"}},he={class:"block"},ye={style:{"word-wrap":"break-word"}},ke={style:{"word-wrap":"break-word"}},be={style:{display:"flex","align-items":"left"}},ge={style:{display:"flex","align-items":"left"}},Ce={style:{"margin-left":"3px"}},Ne=J({name:"TransactionsQueue"}),De=J({...Ne,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup(K){const a=K,q=new $(ce),G=new $(x),p=C(!1),B=C([]),O=C(null),P=C(0),A=C(0),H=C(0),E=async()=>{p.value=!0;const r=F(x,a.currentWallet,a.web3);P.value=le[a.connectedWallet.chainId],A.value=await a.web3.eth.getBlockNumber(),H.value=Math.ceil((A.value-P.value)/M),B.value=[];const v=(await r.methods.getTransactionIds(0).call()).map(async c=>{const i=await r.methods.getTransaction(c).call(),R=await r.methods.getTransactionConfirmationStatus(c,a.connectedWallet.address).call(),S=await a.web3.eth.getChainId();O.value=de(ue(parseInt(S)));let y=1,N="",k="",D=i.to,T=null,L=null;if(i.to.toLowerCase()===a.currentWallet.toLowerCase()){y=2;const e=i.data?G.decodeData(i.data):null;e&&(N=e.method)}else{y=1;const e=i.data?q.decodeData(i.data):null;if(k=O.value.token,T=V(i.value,a.web3),e){const t=re[S].filter(b=>b.token.toLowerCase()===i.to.toLowerCase());N=e.method,k=t.length>0?t[0].symbol:O.value.token,D=e.inputs[0],T=V(new a.web3.utils.toBN(e.inputs[1].toString()),a.web3),L={to:e.inputs[0],value:V(new a.web3.utils.toBN(e.inputs[1].toString()),a.web3)}}}const I={id:c,destination:D,tokenSymbol:k,value:T,data:L,confirmations:i.confirmations,revokes:i.revokes,executeState:i.state,confirmStatus:R,type:y,methodName:N,events:[]};for(let e=0;e<H.value;e++){const t=P.value+M*e,b=t+(M-1),Z=await r.getPastEvents("TransactionCreated",{filter:{transactionId:c},fromBlock:t,toBlock:b}),ee=await r.getPastEvents("TransactionConfirmed",{filter:{transactionId:c},fromBlock:t,toBlock:b}),te=await r.getPastEvents("TransactionRevoke",{filter:{transactionId:c},fromBlock:t,toBlock:b}),Q=Z.concat(ee,te);if(Q.length>0){const ae=Q.map(async g=>{const ne=await a.web3.eth.getTransaction(g.transactionHash),oe={eventName:g.event,...g.returnValues,transactionHash:g.transactionHash,blockNumber:g.blockNumber,from:ne.from,createTime:ie(g.returnValues.createTime)};I.events.push(oe)});await Promise.all(ae),I.events.sort(j("blockNumber"))}}B.value.push(I)});await Promise.all(v),B.value.sort(j("id")),p.value=!1};me(()=>{a.connectedWallet&&a.web3&&a.currentWallet&&E()});const U=r=>{p.value=!0,F(x,a.currentWallet,a.web3).methods.confirmTransaction(r.id).send({from:a.connectedWallet.address}).then(async()=>{await E()}).catch(v=>{console.error(v)}).finally(()=>{p.value=!1})},X=r=>{p.value=!0,F(x,a.currentWallet,a.web3).methods.executeTransaction(r.id).send({from:a.connectedWallet.address}).then(async()=>{await E()}).catch(v=>{console.error(v)}).finally(()=>{p.value=!1})},Y=r=>{p.value=!0,F(x,a.currentWallet,a.web3).methods.revokeTransaction(r.id).send({from:a.connectedWallet.address}).then(async()=>{await E()}).catch(v=>{console.error(v)}).finally(()=>{p.value=!1})};return(r,W)=>{const v=m("el-divider"),c=m("el-tag"),i=m("el-card"),R=m("el-timeline-item"),S=m("el-timeline"),y=m("el-table-column"),N=m("IconifyIconOffline"),k=m("el-dropdown-item"),D=m("el-dropdown-menu"),T=m("el-dropdown"),L=m("el-table"),I=fe("loading");return d(),z("div",null,[_e((d(),f(L,{data:B.value,style:{width:"100%"}},{default:n(()=>[w(y,{type:"expand"},{default:n(e=>[_("p",ve,o(s(l)("transaction.destination"))+": "+o(e.row.destination),1),w(v),_("div",he,[e.row.events.length>0?(d(),f(S,{key:0},{default:n(()=>[(d(!0),z(we,null,pe(e.row.events,(t,b)=>(d(),f(R,{key:b,timestamp:t.createTime,placement:"top"},{default:n(()=>[w(i,null,{default:n(()=>[_("h4",null,[u(o(s(l)("transaction.eventName"))+": ",1),t.eventName=="TransactionCreated"?(d(),f(c,{key:0,type:"warning"},{default:n(()=>[u(o(t.eventName?s(l)("transaction."+t.eventName):""),1)]),_:2},1024)):h("",!0),t.eventName=="TransactionConfirmed"?(d(),f(c,{key:1,type:"success"},{default:n(()=>[u(o(t.eventName?s(l)("transaction."+t.eventName):""),1)]),_:2},1024)):h("",!0),t.eventName=="TransactionRevoke"?(d(),f(c,{key:2,type:"danger"},{default:n(()=>[u(o(t.eventName?s(l)("transaction."+t.eventName):""),1)]),_:2},1024)):h("",!0),t.eventName=="TransactionExecuted"?(d(),f(c,{key:3},{default:n(()=>[u(o(t.eventName?s(l)("transaction."+t.eventName):""),1)]),_:2},1024)):h("",!0)]),_("p",ye,[u(o(s(l)("transaction.eventFrom"))+": ",1),_("span",null,o(t.from),1)]),_("p",ke,[u(o(s(l)("transaction.eventTransactionHash"))+": ",1),_("span",null,o(t.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):h("",!0)])]),_:1}),w(y,{label:s(l)("transaction.type")},{default:n(e=>[_("div",be,[e.row.type==1?(d(),f(c,{key:0,type:"success"},{default:n(()=>[u(o(s(l)("transaction."+e.row.methodName)),1)]),_:2},1024)):h("",!0),e.row.type==2?(d(),f(c,{key:1,type:"warning"},{default:n(()=>[u(o(s(l)("transaction."+e.row.methodName)),1)]),_:2},1024)):h("",!0)])]),_:1},8,["label"]),w(y,{label:s(l)("transaction.value")},{default:n(e=>[_("div",ge,[_("span",null,o(e.row.value),1),_("span",Ce,o(e.row.tokenSymbol),1)])]),_:1},8,["label"]),w(y,{label:s(l)("assets.operation")},{default:n(e=>[w(T,{trigger:"click"},{dropdown:n(()=>[w(D,null,{default:n(()=>[e.row.confirmStatus?h("",!0):(d(),f(k,{key:0,onClick:t=>U(e.row)},{default:n(()=>[u(o(s(l)("transaction.btnConfirm")),1)]),_:2},1032,["onClick"])),e.row.confirmStatus?h("",!0):(d(),f(k,{key:1,onClick:t=>Y(e.row)},{default:n(()=>[u(o(s(l)("transaction.btnRevoke")),1)]),_:2},1032,["onClick"])),w(k,{onClick:t=>X(e.row),divided:""},{default:n(()=>[u(o(s(l)("transaction.btnExecute")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[w(N,{icon:s(se),class:"text-[24px]"},null,8,["icon"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[I,p.value]])])}}});export{De as _};
