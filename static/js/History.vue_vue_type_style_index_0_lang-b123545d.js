import{E as o}from"./___vite-browser-external_commonjs-proxy-7f1f402a.js";import{g as Q,M as q,E as G,b as K,a as H}from"./web3-62625531.js";import{d as U,a as X,p as Y,c as M}from"./decodeParams-f5fdd745.js";import{B as Z}from"./ButtonOfCopy-9be7905e.js";import{i as $}from"./chains-85289d49.js";import{x as O,r as h,o as tt,a7 as p,aa as et,y as i,z as I,J as at,H as f,I as s,P as m,A as c,M as u,O as a,u as e,F as P,a0 as L,L as g}from"./runtime-core.esm-bundler-c80a0204.js";const nt={style:{"word-wrap":"break-word"}},ot={class:"block"},st={style:{"word-wrap":"break-word"}},lt={style:{"word-wrap":"break-word"}},rt={style:{display:"flex","align-items":"left"}},ct={style:{display:"flex","align-items":"left"}},it={style:{"margin-left":"3px"}},ut={style:{display:"flex","align-items":"left"}},dt=O({name:"TransactionsHistory"}),wt=O({...dt,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup(A){const l=A,x=h(!1),k=h([]),W=h(null),N=h(0),V=h(0),R=h(0),j=async()=>{x.value=!0;const y=Q(q,l.currentWallet,l.web3);N.value=G[l.connectedWallet.chainId],V.value=await l.web3.eth.getBlockNumber(),R.value=Math.ceil((V.value-N.value)/K),k.value=[];const D=await y.methods.getTransactionIds(1).call(),T=await y.methods.getTransactionIds(2).call(),d=D.concat(T),B=await y.getPastEvents("allEvents",{filter:{transactionId:d},fromBlock:N.value,toBlock:"latest"}),C=d.map(async v=>{const r=await y.methods.getTransaction(v).call(),S=await y.methods.getTransactionConfirmationStatus(v,l.connectedWallet.address).call(),E=await l.web3.eth.getChainId();W.value=$(E);const t={id:v,destination:r.to,tokenSymbol:"",value:null,data:null,confirmations:r.confirmations,revokes:r.revokes,executeState:r.state,confirmStatus:S,type:1,methodName:"",events:[]};let n=null;r.to.toLowerCase()===l.currentWallet.toLowerCase()?n=U(r):n=X(r,W,l.web3);const _={...t,...n},F=await B.filter(b=>{if(b.returnValues.transactionId&&b.returnValues.transactionId==v)return b});if(F.length>0){const b=F.map(async w=>{const z=await l.web3.eth.getTransaction(w.transactionHash),J={eventName:w.event,...w.returnValues,transactionHash:w.transactionHash,blockNumber:w.blockNumber,from:z.from,createTime:Y(w.returnValues.createTime)};_.events.push(J)});await Promise.all(b),_.events.sort(M("blockNumber"))}k.value.push(_)});await Promise.all(C),k.value.sort(M("id")),x.value=!1};return tt(()=>{l.connectedWallet&&l.web3&&l.currentWallet&&j()}),(y,D)=>{const T=p("el-divider"),d=p("el-tag"),B=p("el-card"),C=p("el-timeline-item"),v=p("el-timeline"),r=p("el-table-column"),S=p("el-table"),E=et("loading");return i(),I("div",null,[at((i(),f(S,{data:k.value,style:{width:"100%"}},{default:s(()=>[m(r,{type:"expand"},{default:s(t=>[c("p",nt,[u(a(e(o)("transaction.destination"))+": ",1),m(Z,{text:t.row.destination},null,8,["text"])]),(i(!0),I(P,null,L(t.row.data,(n,_)=>(i(),I("p",{style:{"word-wrap":"break-word"},key:_},a(e(o)("transaction."+n.name))+": "+a(n.value),1))),128)),m(T),c("div",ot,[t.row.events.length>0?(i(),f(v,{key:0},{default:s(()=>[(i(!0),I(P,null,L(t.row.events,(n,_)=>(i(),f(C,{key:_,timestamp:n.createTime,placement:"top"},{default:s(()=>[m(B,null,{default:s(()=>[c("h4",null,[u(a(e(o)("transaction.eventName"))+": ",1),m(d,{type:e(H)[n.eventName].tagType},{default:s(()=>[u(a(e(H)[n.eventName].name?e(o)("transaction."+e(H)[n.eventName].name):""),1)]),_:2},1032,["type"])]),c("p",st,[u(a(e(o)("transaction.eventFrom"))+": ",1),c("span",null,a(n.from),1)]),c("p",lt,[u(a(e(o)("transaction.eventTransactionHash"))+": ",1),c("span",null,a(n.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):g("",!0)])]),_:1}),m(r,{label:e(o)("transaction.type")},{default:s(t=>[c("div",rt,[t.row.type==1?(i(),f(d,{key:0,type:"success"},{default:s(()=>[u(a(e(o)("transaction."+t.row.methodName)),1)]),_:2},1024)):g("",!0),t.row.type==2?(i(),f(d,{key:1,type:"warning"},{default:s(()=>[u(a(e(o)("transaction."+t.row.methodName)),1)]),_:2},1024)):g("",!0)])]),_:1},8,["label"]),m(r,{label:e(o)("transaction.value")},{default:s(t=>[c("div",ct,[c("span",null,a(t.row.value),1),c("span",it,a(t.row.tokenSymbol),1)])]),_:1},8,["label"]),m(r,{label:e(o)("transaction.status")},{default:s(t=>[c("div",ut,[t.row.executeState==1?(i(),f(d,{key:0,type:"success"},{default:s(()=>[u(a(e(o)("transaction.statusSuccess")),1)]),_:1})):g("",!0),t.row.executeState==2?(i(),f(d,{key:1,type:"danger"},{default:s(()=>[u(a(e(o)("transaction.statusRevoke")),1)]),_:1})):g("",!0)])]),_:1},8,["label"])]),_:1},8,["data"])),[[E,x.value]])])}}});export{wt as _};
