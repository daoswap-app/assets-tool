import{t as c,a as ee,v as H}from"./i18n-d274a306.js";import te from"./Card-5b06dd02.js";import{m as le}from"./message-ef4ab9c6.js";import{b as J,a as ae,i as ne}from"./addresses-bd8a7f8c.js";import{W as oe,u as X}from"./web3Modal-7e7ca6c0.js";import{h as q,r as p,J as se,o as G,w as $,a3 as i,j as f,v as S,x as l,D as t,B as h,C as A,u as m,k as T,X as P,F as z,A as K,a6 as re,l as ue,y as j,I as ie}from"./runtime-core.esm-bundler-f67957fc.js";import{u as de}from"./hooks-860700ae.js";import{J as ce}from"./index-ce133961.js";const Q={[J.localhost]:"0x31B48B6484c7D93f43a3838652A86b18740E37C6",[J.bnbt]:"0x28A98E363D777c943EBA7bBc384046332643f908"},Y=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"eventCreateWallet",type:"event"},{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"address[]",name:"_owners",type:"address[]"},{internalType:"uint256",name:"_required",type:"uint256"}],name:"createWallet",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAllWallet",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getWalletList",outputs:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"ownerCount",type:"uint256"},{internalType:"uint256",name:"threshold",type:"uint256"},{internalType:"address[]",name:"owners",type:"address[]"}],internalType:"struct Wallet.WalletItem[]",name:"walletList",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}];function me(w){return oe.utils.toChecksumAddress(w)}function Z(w,b,k){return b?new k.eth.Contract(w,me(b)):new k.eth.Contract(w)}const pe=q({__name:"AddWallet",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},emits:["update:visible"],setup(w,{emit:b}){const k=w,V=p(!1),n=p(!1),_=p(null),I=p(null),B={name:"1rens",owners:[],confirmNumber:1},C=p(),o=se(B);G(()=>{V.value=!0,_.value=X().getWallet,I.value=X().getWeb3,o.owners.push({name:"self",address:_.value.address,error:""}),V.value=!1});const y=async()=>{const a=await C.value.validate(s=>!!s);let e=0;return o.owners.map(s=>{if(!s.name||!s.address){e++,s.error=c("wallet.please add owners");return}else{if(s.address&&(s.address=ae(s.address),!ne(s.address))){e++,s.error=c("wallet.invalid wallet address");return}const r=o.owners.filter(v=>v.address===s.address);if(r.length>1){const v=c("wallet.owner is already added");e++,s.error=v,r.map(g=>{g.error=v});return}else{e=e===0?0:e--,s.error="";return}}}),e<=0&&a},D=async()=>{if(await y()){V.value=!0;const e=[];o.owners.map(r=>{e.push(r.address)}),Z(Y,Q[_.value.chainId],I.value).methods.createWallet(o.name,e,o.confirmNumber).send({from:_.value.address}).then(r=>{console.info(r)}).catch(r=>{console.error(r)}).finally(()=>{V.value=!1,L()})}},N=a=>{const e=o.owners.indexOf(a);e!==-1&&o.owners.splice(e,1)},M=()=>{const a={name:"",address:"",error:""};o.owners.push(a)},L=()=>{n.value=!1};return $(()=>n.value,a=>{b("update:visible",a)}),$(()=>k.visible,a=>{n.value=a}),$(()=>o.owners.length,a=>{o.confirmNumber>o.owners.length&&(o.confirmNumber=a)}),(a,e)=>{const s=i("el-input"),r=i("el-col"),v=i("el-row"),g=i("el-form-item"),x=i("el-button"),F=i("el-divider"),O=i("el-option"),U=i("el-select"),E=i("el-form"),d=i("el-dialog");return f(),S(d,{modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=u=>n.value=u),title:m(c)("wallet.createWallet"),width:"90%",draggable:"","close-on-click-modal":!1,"before-close":L},{footer:l(()=>[t(x,{onClick:L},{default:l(()=>[h(A(m(c)("wallet.btnCancel")),1)]),_:1}),t(x,{type:"primary",onClick:D},{default:l(()=>[h(A(m(c)("wallet.btnSubmit")),1)]),_:1})]),default:l(()=>[t(E,{ref_key:"walletFormRef",ref:C,model:o,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:l(()=>[t(g,{prop:"name",label:m(c)("wallet.name"),style:{width:"100%"},rules:[{required:!0,message:m(c)("wallet.please input wallet name"),trigger:"blur"}]},{default:l(()=>[t(v,{gutter:20,style:{width:"100%"}},{default:l(()=>[t(r,{span:24},{default:l(()=>[t(s,{modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=u=>o.name=u)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),t(g,{prop:"owners",label:m(c)("wallet.owners"),style:{width:"100%"}},{default:l(()=>[(f(!0),T(z,null,P(o.owners,(u,R)=>(f(),S(g,{style:{width:"100%","margin-bottom":"1.2rem"},key:R,error:u.error},{default:l(()=>[t(v,{gutter:10,style:{width:"100%"}},{default:l(()=>[t(r,{xs:4,md:1},{default:l(()=>[h(A(R+1),1)]),_:2},1024),t(r,{xs:20,md:4},{default:l(()=>[t(s,{modelValue:u.name,"onUpdate:modelValue":W=>u.name=W,onBlur:e[1]||(e[1]=W=>y())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{xs:18,md:15},{default:l(()=>[t(s,{modelValue:u.address,"onUpdate:modelValue":W=>u.address=W,onBlur:e[2]||(e[2]=W=>y())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{xs:6,md:4},{default:l(()=>[R!==0?(f(),S(x,{key:0,onClick:ee(W=>N(u),["prevent"])},{default:l(()=>[h("删除")]),_:2},1032,["onClick"])):K("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["error"]))),128))]),_:1},8,["label"]),t(g,null,{default:l(()=>[t(x,{type:"primary",onClick:M},{default:l(()=>[h(A(m(c)("wallet.btnAddOwner")),1)]),_:1})]),_:1}),t(F),t(g,{prop:"confirmNumber",label:m(c)("wallet.confirmNumber"),style:{width:"100%"},rules:[{required:!0,message:m(c)("wallet.please select confirm number"),trigger:"change"}]},{default:l(()=>[t(v,{gutter:20,style:{width:"100%"}},{default:l(()=>[t(r,{span:2},{default:l(()=>[t(U,{modelValue:o.confirmNumber,"onUpdate:modelValue":e[3]||(e[3]=u=>o.confirmNumber=u)},{default:l(()=>[(f(!0),T(z,null,P(o.owners.length,u=>(f(),S(O,{key:u,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{span:1},{default:l(()=>[h("/")]),_:1}),t(r,{span:2},{default:l(()=>[h(A(o.owners.length),1)]),_:1}),t(r,{span:19})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),fe={width:1024,height:1024,body:'<path fill="currentColor" d="m795.904 750.72l124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704a352 352 0 0 0 0 704z"/>'},ve=fe,_e={width:24,height:24,body:'<path fill="currentColor" d="M11 11V7h2v4h4v2h-4v4h-2v-4H7v-2h4zm1 11C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/>'},ye=_e,ge={class:"main"},we={class:"w-full flex justify-between mb-4"},be=q({name:"HomeWallet"}),Ie=q({...be,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null}},setup(w){const b=w,k=`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `,V={name:"",status:"",description:"",type:"",mark:""},n=p({current:1,pageSize:12,total:0}),_=p([]),I=p(!0),B=async()=>{try{const e=await Z(Y,Q[b.connectedWallet.chainId],b.web3).methods.getWalletList().call({from:b.connectedWallet.address});console.info(e),_.value=e,n.value={...n.value,total:_.value.length}}catch{}finally{setTimeout(()=>{I.value=!1},500)}};G(()=>{B()});const C=p(!1),o=p({...V}),y=p(""),D=a=>{n.value.pageSize=a,n.value.current=1},N=a=>{n.value.current=a},M=a=>{ce.confirm(a?`确认删除后${a.name}的所有产品信息将被清空, 且无法恢复`:"","提示",{type:"warning"}).then(()=>{le("删除成功",{type:"success"})}).catch(()=>{})},L=a=>{C.value=!0,ie(()=>{o.value={...a,status:a!=null&&a.isSetup?"1":"0"}})};return(a,e)=>{const s=i("el-button"),r=i("IconifyIconOffline"),v=i("el-icon"),g=i("el-input"),x=i("el-empty"),F=i("el-col"),O=i("el-row"),U=i("el-pagination"),E=re("loading");return f(),T("div",ge,[ue("div",we,[t(s,{icon:m(de)(m(ye)),onClick:e[0]||(e[0]=d=>C.value=!0)},{default:l(()=>[h(A(m(c)("wallet.btnAdd")),1)]),_:1},8,["icon"]),t(g,{style:{width:"300px"},modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=d=>y.value=d),placeholder:m(c)("wallet.address"),clearable:""},{suffix:l(()=>[t(v,{class:"el-input__icon"},{default:l(()=>[j(t(r,{icon:m(ve)},null,8,["icon"]),[[H,y.value.length===0]])]),_:1})]),_:1},8,["modelValue","placeholder"])]),j((f(),T("div",{"element-loading-svg":k,"element-loading-svg-view-box":"-10, -10, 50, 50"},[j(t(x,{description:"暂无数据"},null,512),[[H,_.value.slice(n.value.pageSize*(n.value.current-1),n.value.pageSize*n.value.current).filter(d=>d.name.toLowerCase().includes(y.value.toLowerCase())).length===0]]),n.value.total>0?(f(),T(z,{key:0},[t(O,{gutter:16},{default:l(()=>[(f(!0),T(z,null,P(_.value.slice(n.value.pageSize*(n.value.current-1),n.value.pageSize*n.value.current).filter(d=>d.name.toLowerCase().includes(y.value.toLowerCase())),(d,u)=>(f(),S(F,{key:u,xs:24,sm:12,md:8,lg:6,xl:4},{default:l(()=>[t(te,{product:d,onDeleteItem:M,onManageProduct:L},null,8,["product"])]),_:2},1024))),128))]),_:1}),t(U,{class:"float-right",currentPage:n.value.current,"onUpdate:currentPage":e[2]||(e[2]=d=>n.value.current=d),"page-size":n.value.pageSize,total:n.value.total,"page-sizes":[12,24,36],background:!0,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:D,onCurrentChange:N},null,8,["currentPage","page-size","total"])],64)):K("",!0)])),[[E,I.value]]),t(pe,{visible:C.value,"onUpdate:visible":e[3]||(e[3]=d=>C.value=d),data:o.value},null,8,["visible","data"])])}}});export{Ie as _};
