import{E as r}from"./___vite-browser-external_commonjs-proxy-7f1f402a.js";import{A as j}from"./arrow-down-s-line-da487a0d.js";import{g as W,M as S,a as P}from"./web3-3cbc8076.js";import{g as z,d as J,a as q,c as G}from"./getLogs-090aaf23.js";import{B as K}from"./ButtonOfCopy-7cfa85d9.js";import{i as U}from"./chains-68c757ba.js";import{x as M,r as A,o as X,a7 as i,aa as Y,y as l,z as h,J as Z,H as y,I as o,P as d,A as w,M as u,O as a,u as n,F as E,a0 as F,L as v}from"./runtime-core.esm-bundler-c80a0204.js";const tt={style:{"word-wrap":"break-word"}},et={key:0},nt={key:1},at={style:{"word-wrap":"break-word"}},ot={class:"block"},rt={style:{"word-wrap":"break-word"}},lt={style:{"word-wrap":"break-word"}},st={style:{display:"flex","align-items":"left"}},ct=M({name:"TransactionsQueue"}),pt=M({...ct,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup(V){const e=V,m=A(!1),C=A([]),I=async()=>{m.value=!0;const c=W(S,e.currentWallet,e.web3);C.value=[];const _=(await c.methods.getTransactionIds(0).call()).map(async p=>{const f=await c.methods.getTransaction(p).call(),N=await c.methods.getTransactionConfirmationStatus(p,e.connectedWallet.address).call(),T=await e.web3.eth.getChainId(),k=U(T),B={transactionId:p},b=await z(c,T,e.web3,B),D={id:p,destination:f.to,tokenSymbol:"",value:null,data:null,confirmations:f.confirmations,revokes:f.revokes,executeState:f.state,confirmStatus:N,type:1,methodName:"",events:b};let g=null;f.to.toLowerCase()===e.currentWallet.toLowerCase()?g=J(f):g=q(f,k,e.web3);const L={...D,...g};C.value.push(L)});await Promise.all(_),C.value.sort(G("id")),m.value=!1};X(()=>{e.connectedWallet&&e.web3&&e.currentWallet&&I()});const H=c=>{m.value=!0,W(S,e.currentWallet,e.web3).methods.confirmTransaction(c.id).send({from:e.connectedWallet.address}).then(async()=>{await I()}).catch(_=>{console.error(_)}).finally(()=>{m.value=!1})},Q=c=>{m.value=!0,W(S,e.currentWallet,e.web3).methods.executeTransaction(c.id).send({from:e.connectedWallet.address}).then(async()=>{await I()}).catch(_=>{console.error(_)}).finally(()=>{m.value=!1})},R=c=>{m.value=!0,W(S,e.currentWallet,e.web3).methods.revokeTransaction(c.id).send({from:e.connectedWallet.address}).then(async()=>{await I()}).catch(_=>{console.error(_)}).finally(()=>{m.value=!1})};return(c,x)=>{const _=i("el-divider"),p=i("el-tag"),f=i("el-card"),N=i("el-timeline-item"),T=i("el-timeline"),k=i("el-table-column"),B=i("IconifyIconOffline"),b=i("el-dropdown-item"),D=i("el-dropdown-menu"),g=i("el-dropdown"),L=i("el-table"),$=Y("loading");return l(),h("div",null,[Z((l(),y(L,{data:C.value,style:{width:"100%"}},{default:o(()=>[d(k,{type:"expand"},{default:o(t=>[w("p",tt,[u(a(n(r)("transaction.destination"))+": ",1),d(K,{text:t.row.destination},null,8,["text"])]),t.row.type==2?(l(),h("div",et,[(l(!0),h(E,null,F(t.row.data,(s,O)=>(l(),h("p",{style:{"word-wrap":"break-word"},key:O},a(n(r)("transaction."+s.name))+": "+a(s.value),1))),128))])):v("",!0),t.row.type==1?(l(),h("div",nt,[w("p",at,a(n(r)("transaction.amount"))+": "+a(t.row.value)+" "+a(t.row.tokenSymbol),1)])):v("",!0),d(_),w("div",ot,[t.row.events.length>0?(l(),y(T,{key:0},{default:o(()=>[(l(!0),h(E,null,F(t.row.events,(s,O)=>(l(),y(N,{key:O,timestamp:s.createTime,placement:"top"},{default:o(()=>[d(f,null,{default:o(()=>[w("h4",null,[u(a(n(r)("transaction.eventName"))+": ",1),d(p,{type:n(P)[s.eventName].tagType},{default:o(()=>[u(a(n(P)[s.eventName].name?n(r)("transaction."+n(P)[s.eventName].name):""),1)]),_:2},1032,["type"])]),w("p",rt,[u(a(n(r)("transaction.eventFrom"))+": ",1),w("span",null,a(s.from),1)]),w("p",lt,[u(a(n(r)("transaction.eventTransactionHash"))+": ",1),w("span",null,a(s.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):v("",!0)])]),_:1}),d(k,{label:n(r)("transaction.type")},{default:o(t=>[w("div",st,[t.row.type==1?(l(),y(p,{key:0,type:"success"},{default:o(()=>[u(a(n(r)("transaction."+t.row.methodName)),1)]),_:2},1024)):v("",!0),t.row.type==2?(l(),y(p,{key:1,type:"warning"},{default:o(()=>[u(a(n(r)("transaction."+t.row.methodName)),1)]),_:2},1024)):v("",!0)])]),_:1},8,["label"]),d(k,{label:n(r)("assets.operation")},{default:o(t=>[d(g,{trigger:"click"},{dropdown:o(()=>[d(D,null,{default:o(()=>[t.row.confirmStatus?v("",!0):(l(),y(b,{key:0,onClick:s=>H(t.row)},{default:o(()=>[u(a(n(r)("transaction.btnConfirm")),1)]),_:2},1032,["onClick"])),t.row.confirmStatus?v("",!0):(l(),y(b,{key:1,onClick:s=>R(t.row)},{default:o(()=>[u(a(n(r)("transaction.btnRevoke")),1)]),_:2},1032,["onClick"])),d(b,{onClick:s=>Q(t.row),divided:!t.row.confirmStatus},{default:o(()=>[u(a(n(r)("transaction.btnExecute")),1)]),_:2},1032,["onClick","divided"])]),_:2},1024)]),default:o(()=>[d(B,{icon:n(j),class:"text-[24px]"},null,8,["icon"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[$,m.value]])])}}});export{pt as _};
