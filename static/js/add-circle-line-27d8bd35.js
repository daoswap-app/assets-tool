import{t as u,w as j}from"./i18n-4a0f4af2.js";import{c as P,i as G}from"./addresses-acfad7e8.js";import{u as B}from"./web3Modal-4ce521cd.js";import{W as J}from"./constants-b9202782.js";import{g as K}from"./web3-dfdb1234.js";import{x as Q,r as v,o as X,w as h,a7 as d,y as w,H as k,I as l,P as a,M as f,O as _,u as i,z as I,a0 as L,F as O,L as Y}from"./runtime-core.esm-bundler-c80a0204.js";const Z=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"eventCreateWallet",type:"event"},{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"address[]",name:"_owners",type:"address[]"},{internalType:"uint256",name:"_required",type:"uint256"}],name:"createWallet",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAllWallet",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getWalletList",outputs:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"ownerCount",type:"uint256"},{internalType:"uint256",name:"threshold",type:"uint256"},{internalType:"address[]",name:"owners",type:"address[]"}],internalType:"struct Wallet.WalletItem[]",name:"walletList",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}],oe=Q({__name:"AddWallet",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},emits:["update:visible","refresh-wallet-list"],setup(R,{emit:W}){const N=R,m=v(!1),y=v(!1),b=v(null),x=v(null),A={name:"1rens",owners:[],confirmNumber:1},F=v(),e=v(A);X(()=>{m.value=!0,b.value=B().getWallet,x.value=B().getWeb3,e.value.owners.push({address:b.value.address,error:""}),m.value=!1});const M=async()=>{const n=await F.value.validate(r=>!!r);let t=0;return e.value.owners.map(r=>{if(r.address){if(r.address&&(r.address=P(r.address),!G(r.address))){t++,r.error=u("wallet.invalid wallet address");return}const s=e.value.owners.filter(p=>p.address===r.address);if(s.length>1){const p=u("wallet.owner is already added");t++,r.error=p,s.map(c=>{c.error=p});return}else{t=t===0?0:t--,r.error="";return}}else{t++,r.error=u("wallet.please add owners");return}}),t<=0&&n},S=async()=>{if(await M()){m.value=!0;const t=[];e.value.owners.map(s=>{t.push(s.address)}),K(Z,J[b.value.chainId],x.value).methods.createWallet(e.value.name,t,e.value.confirmNumber).send({from:b.value.address}).then(()=>{W("refresh-wallet-list")}).catch(s=>{console.error(s)}).finally(()=>{m.value=!1,V()})}},U=n=>{const t=e.value.owners.indexOf(n);t!==-1&&e.value.owners.splice(t,1)},q=()=>{const n={name:"",address:"",error:""};e.value.owners.push(n)},V=()=>{y.value=!1};return h(()=>y.value,n=>{W("update:visible",n)}),h(()=>N.visible,n=>{y.value=n}),h(()=>N.data,n=>{m.value=!0,n?(e.value.name=n.name,e.value.confirmNumber=n.threshold,e.value.owners=[],n.owners.map(t=>{e.value.owners.push({address:t,error:""})})):e.value=A,m.value=!1}),h(()=>e.value.owners.length,n=>{e.value.confirmNumber>e.value.owners.length&&(e.value.confirmNumber=n)}),(n,t)=>{const r=d("el-input"),s=d("el-col"),p=d("el-row"),c=d("el-form-item"),g=d("el-button"),z=d("el-divider"),D=d("el-option"),E=d("el-select"),H=d("el-form"),$=d("el-dialog");return w(),k($,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=o=>y.value=o),title:i(u)("wallet.createWallet"),width:"90%",draggable:"","close-on-click-modal":!1,"before-close":V},{footer:l(()=>[a(g,{loading:m.value,onClick:V},{default:l(()=>[f(_(i(u)("wallet.btnCancel")),1)]),_:1},8,["loading"]),a(g,{loading:m.value,type:"primary",onClick:S},{default:l(()=>[f(_(i(u)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:l(()=>[a(H,{ref_key:"walletFormRef",ref:F,model:e.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:l(()=>[a(c,{prop:"name",label:i(u)("wallet.name"),style:{width:"100%"},rules:[{required:!0,message:i(u)("wallet.please input wallet name"),trigger:"blur"}]},{default:l(()=>[a(p,{gutter:20,style:{width:"100%"}},{default:l(()=>[a(s,{span:24},{default:l(()=>[a(r,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.name=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),a(c,{prop:"owners",label:i(u)("wallet.owners"),style:{width:"100%"}},{default:l(()=>[(w(!0),I(O,null,L(e.value.owners,(o,C)=>(w(),k(c,{style:{width:"100%","margin-bottom":"1.2rem"},key:C,error:o.error},{default:l(()=>[a(p,{gutter:10,style:{width:"100%"}},{default:l(()=>[a(s,{xs:4,md:1},{default:l(()=>[f(_(C+1),1)]),_:2},1024),a(s,{xs:14,md:19},{default:l(()=>[a(r,{modelValue:o.address,"onUpdate:modelValue":T=>o.address=T,onBlur:t[1]||(t[1]=T=>M())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(s,{xs:6,md:4},{default:l(()=>[C!==0?(w(),k(g,{key:0,onClick:j(T=>U(o),["prevent"])},{default:l(()=>[f("删除")]),_:2},1032,["onClick"])):Y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["error"]))),128))]),_:1},8,["label"]),a(c,null,{default:l(()=>[a(g,{type:"primary",onClick:q},{default:l(()=>[f(_(i(u)("wallet.btnAddOwner")),1)]),_:1})]),_:1}),a(z),a(c,{prop:"confirmNumber",label:i(u)("wallet.confirmNumber"),style:{width:"100%"},rules:[{required:!0,message:i(u)("wallet.please select confirm number"),trigger:"change"}]},{default:l(()=>[a(p,{gutter:20,style:{width:"100%"}},{default:l(()=>[a(s,{span:2},{default:l(()=>[a(E,{modelValue:e.value.confirmNumber,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.confirmNumber=o)},{default:l(()=>[(w(!0),I(O,null,L(e.value.owners.length,o=>(w(),k(D,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{span:1},{default:l(()=>[f("/")]),_:1}),a(s,{span:2},{default:l(()=>[f(_(e.value.owners.length),1)]),_:1}),a(s,{span:19})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ee={width:24,height:24,body:'<path fill="currentColor" d="M11 11V7h2v4h4v2h-4v4h-2v-4H7v-2h4zm1 11C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/>'},ue=ee;export{ue as A,Z as W,oe as _};
