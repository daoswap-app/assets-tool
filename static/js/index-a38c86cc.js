import{E as r}from"./___vite-browser-external_commonjs-proxy-eabcf697.js";import{u as S}from"./web3Modal-fa8b4a0e.js";import{c as Q,i as X}from"./addresses-868f69ee.js";import{u as E}from"./wallet-bb188ab2.js";import{g as D,M as Y,e as j,T as Z,w as H}from"./web3-5746e9c3.js";import{E as z}from"./ERC20_abi-801f43f8.js";import{x as O,r as i,o as P,w as R,a7 as u,y as V,H as F,I as t,P as e,M as x,O as k,u as m,z as $,a0 as ee,F as te,aa as ae,A as y,J as le,L as se}from"./runtime-core.esm-bundler-c80a0204.js";import{i as oe,j as ne}from"./index-997097ac.js";import{B as re}from"./ButtonOfCopy-b4d19cd5.js";import"./vue-i18n.runtime.esm-bundler-d653d868.js";import"./web3.min-86d33c45.js";import"./index-58e05066.js";import"./vue-router-935545c9.js";import"./utils-9dafa53e.js";import"./message-c0d7d08e.js";import"./index-b35d802c.js";import"./_plugin-vue_export-helper-c27b6911.js";const ie=O({__name:"SendTransaction",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null},tokenList:{type:Object,default:()=>[]}},emits:["update:visible","refresh-asset-list"],setup(M,{emit:T}){const b=M,p=i(!1),v=i(!1),h=i(""),A=i(null),w=i(null),C={sendAddress:"",recipientAddress:"",assetToken:"",amount:""},W=i(),a=i(C);P(()=>{h.value=E().getWallet,A.value=S().getWallet,w.value=S().getWeb3,a.value.sendAddress=h.value});const I=(o,s,l)=>{s===""?l(new Error(r("transaction.please input recipient address"))):(a.value.recipientAddress=Q(a.value.recipientAddress),X(a.value.recipientAddress)?l():l(new Error(r("transaction.invalid recipient address"))))},L=(o,s,l)=>{s===""?l(new Error(r("transaction.please input amount"))):parseFloat(s)>parseFloat(b.data.balance)?l(new Error(r("transaction.exceed balance"))):l()},_=async()=>await W.value.validate(o=>!!o),g=async()=>{if(await _()){p.value=!0;const s=D(Y,E().getWallet,w.value),l={destination:a.value.recipientAddress,value:j(a.value.amount,w.value),data:"0x"};if(a.value.assetToken){const c=D(z,a.value.assetToken,w.value),n=j(a.value.amount,w.value),B=await c.methods.transfer(a.value.recipientAddress,n).encodeABI();l.destination=a.value.assetToken,l.value="0",l.data=B}s.methods.submitTransaction(l.destination,l.value,l.data).send({from:A.value.address}).then(()=>{T("refresh-asset-list")}).catch(c=>{console.error(c)}).finally(()=>{p.value=!1,f()})}},f=()=>{v.value=!1};return R(()=>v.value,o=>{T("update:visible",o)}),R(()=>b.visible,o=>{v.value=o}),R(()=>b.data,o=>{a.value.assetToken=o?o.token:""}),(o,s)=>{const l=u("el-col"),c=u("el-row"),n=u("el-form-item"),B=u("el-divider"),N=u("el-input"),q=u("el-option"),J=u("el-select"),K=u("el-form"),U=u("el-button"),G=u("el-dialog");return V(),F(G,{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=d=>v.value=d),title:m(r)("transaction.sendTokens"),width:"80%",draggable:"","close-on-click-modal":!1,"before-close":f},{footer:t(()=>[e(U,{loading:p.value,onClick:f},{default:t(()=>[x(k(m(r)("wallet.btnCancel")),1)]),_:1},8,["loading"]),e(U,{loading:p.value,type:"primary",onClick:g},{default:t(()=>[x(k(m(r)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:t(()=>[e(K,{ref_key:"transactionFormRef",ref:W,model:a.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0,"label-position":"top"},{default:t(()=>[e(n,{prop:"sendAddress",label:m(r)("transaction.sendAddress"),style:{width:"100%"}},{default:t(()=>[e(c,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[x(k(a.value.sendAddress),1)]),_:1})]),_:1})]),_:1},8,["label"]),e(B),e(n,{prop:"recipientAddress",label:m(r)("transaction.recipientAddress"),style:{width:"100%"},rules:[{validator:I,trigger:"blur"}]},{default:t(()=>[e(c,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[e(N,{modelValue:a.value.recipientAddress,"onUpdate:modelValue":s[0]||(s[0]=d=>a.value.recipientAddress=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),e(n,{prop:"assetToken",label:m(r)("transaction.assetToken"),style:{width:"100%"}},{default:t(()=>[e(c,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[e(J,{modelValue:a.value.assetToken,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value.assetToken=d),style:{width:"100%"}},{default:t(()=>[(V(!0),$(te,null,ee(b.tokenList,d=>(V(),F(q,{key:d.token,label:d.symbol+(d.token?" - "+d.token:""),value:d.token},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label"]),e(n,{prop:"amount",label:m(r)("transaction.amount"),style:{width:"100%"},rules:[{validator:L,trigger:"blur"}]},{default:t(()=>[e(c,{gutter:20,style:{width:"100%"}},{default:t(()=>[e(l,{span:24},{default:t(()=>[e(N,{modelValue:a.value.amount,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value.amount=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ue={class:"card-header"},de={class:"font-medium",style:{"word-wrap":"break-word"}},ce={style:{display:"flex","align-items":"left"}},me=y("i",{class:"el-icon-time"},null,-1),pe={style:{"margin-left":"10px"}},ve={style:{display:"flex","align-items":"left"}},fe={style:{"margin-left":"3px"}},_e=O({name:"Assets"}),Re=O({..._e,setup(M){const T=i([]),b=i(!1),p=i(null),v=i(null),h=i([]),A=i(!1),w=i(null),C=i(null);async function W(){v.value=E().getWallet,p.value=S().getWeb3;const _=await p.value.eth.getChainId();Z[_].map(g=>{T.value.push(g.token)}),C.value=oe(ne(parseInt(_)))}const a=async()=>{if(b.value=!0,h.value=[],v.value){const _=await p.value.eth.getBalance(v.value);h.value.push({symbol:C.value.token,token:"",balance:H(_,p.value)});const g=T.value.map(async f=>{const o=D(z,f,p.value),s=await o.methods.symbol().call(),l=await o.methods.balanceOf(E().getWallet).call(),c={symbol:s,token:f,balance:H(l,p.value)};h.value.push(c)});await Promise.all(g)}b.value=!1};P(()=>{W(),a()});const I=_=>{A.value=!0,w.value=_},L=()=>{a()};return(_,g)=>{const f=u("el-table-column"),o=u("el-button"),s=u("el-table"),l=u("el-card"),c=ae("loading");return V(),$("div",null,[e(l,{shadow:"never"},{header:t(()=>[y("div",ue,[y("span",de,[x(k(m(r)("assets.assets"))+" - ",1),e(re,{text:v.value},null,8,["text"])])])]),default:t(()=>[le((V(),F(s,{data:h.value,style:{width:"100%"}},{default:t(()=>[e(f,{label:m(r)("assets.asset")},{default:t(n=>[y("div",ce,[me,y("span",pe,k(n.row.symbol),1)])]),_:1},8,["label"]),e(f,{label:m(r)("assets.balance")},{default:t(n=>[y("div",ve,[y("span",null,k(n.row.balance),1),y("span",fe,k(n.row.symbol),1)])]),_:1},8,["label"]),e(f,{label:m(r)("assets.operation")},{default:t(n=>[parseFloat(n.row.balance)>0?(V(),F(o,{key:0,type:"primary",size:"small",onClick:B=>I(n.row)},{default:t(()=>[x(k(m(r)("wallet.btnSend")),1)]),_:2},1032,["onClick"])):se("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[c,b.value]])]),_:1}),e(ie,{visible:A.value,"onUpdate:visible":g[0]||(g[0]=n=>A.value=n),data:w.value,tokenList:h.value,onRefreshAssetList:L},null,8,["visible","data","tokenList"])])}}});export{Re as default};
