import{E as r}from"./___vite-browser-external_commonjs-proxy-7f1f402a.js";import{A as q}from"./arrow-down-s-line-da487a0d.js";import{g as S,M as E,E as G,a as O}from"./web3-62625531.js";import{d as K,a as U,p as X,c as A}from"./decodeParams-f5fdd745.js";import{B as Y}from"./ButtonOfCopy-9be7905e.js";import{i as Z}from"./chains-85289d49.js";import{x as Q,r as D,o as ee,a7 as d,aa as te,y as s,z as T,J as ae,H as h,I as n,P as c,A as u,M as m,O as o,u as a,F as M,a0 as R,L as C}from"./runtime-core.esm-bundler-c80a0204.js";const ne={style:{"word-wrap":"break-word"}},oe={key:0},le={class:"block"},re={style:{"word-wrap":"break-word"}},se={style:{"word-wrap":"break-word"}},ce={style:{display:"flex","align-items":"left"}},ie={style:{display:"flex","align-items":"left"}},de={style:{"margin-left":"3px"}},ue=Q({name:"TransactionsQueue"}),he=Q({...ue,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup($){const t=$,_=D(!1),N=D([]),H=D(null),L=D(0),W=async()=>{_.value=!0;const i=S(E,t.currentWallet,t.web3);L.value=G[t.connectedWallet.chainId],N.value=[];const b=await i.methods.getTransactionIds(0).call(),f=await i.getPastEvents("allEvents",{filter:{transactionId:b},fromBlock:L.value,toBlock:"latest"}),I=b.map(async k=>{const p=await i.methods.getTransaction(k).call(),F=await i.methods.getTransactionConfirmationStatus(k,t.connectedWallet.address).call(),g=await t.web3.eth.getChainId();H.value=Z(g);const P={id:k,destination:p.to,tokenSymbol:"",value:null,data:null,confirmations:p.confirmations,revokes:p.revokes,executeState:p.state,confirmStatus:F,type:1,methodName:"",events:[]};let v=null;p.to.toLowerCase()===t.currentWallet.toLowerCase()?v=K(p):v=U(p,H.value,t.web3);const x={...P,...v},B=await f.filter(y=>{if(y.returnValues.transactionId&&y.returnValues.transactionId==k)return y});if(B.length>0){const y=B.map(async w=>{const e=await t.web3.eth.getTransaction(w.transactionHash),l={eventName:w.event,...w.returnValues,transactionHash:w.transactionHash,blockNumber:w.blockNumber,from:e.from,createTime:X(w.returnValues.createTime)};x.events.push(l)});await Promise.all(y),x.events.sort(A("blockNumber"))}N.value.push(x)});await Promise.all(I),N.value.sort(A("id")),_.value=!1};ee(()=>{t.connectedWallet&&t.web3&&t.currentWallet&&W()});const j=i=>{_.value=!0,S(E,t.currentWallet,t.web3).methods.confirmTransaction(i.id).send({from:t.connectedWallet.address}).then(async()=>{await W()}).catch(f=>{console.error(f)}).finally(()=>{_.value=!1})},z=i=>{_.value=!0,S(E,t.currentWallet,t.web3).methods.executeTransaction(i.id).send({from:t.connectedWallet.address}).then(async()=>{await W()}).catch(f=>{console.error(f)}).finally(()=>{_.value=!1})},J=i=>{_.value=!0,S(E,t.currentWallet,t.web3).methods.revokeTransaction(i.id).send({from:t.connectedWallet.address}).then(async()=>{await W()}).catch(f=>{console.error(f)}).finally(()=>{_.value=!1})};return(i,b)=>{const f=d("el-divider"),I=d("el-tag"),k=d("el-card"),p=d("el-timeline-item"),F=d("el-timeline"),g=d("el-table-column"),P=d("IconifyIconOffline"),v=d("el-dropdown-item"),x=d("el-dropdown-menu"),B=d("el-dropdown"),y=d("el-table"),w=te("loading");return s(),T("div",null,[ae((s(),h(y,{data:N.value,style:{width:"100%"}},{default:n(()=>[c(g,{type:"expand"},{default:n(e=>[u("p",ne,[m(o(a(r)("transaction.destination"))+": ",1),c(Y,{text:e.row.destination},null,8,["text"])]),e.row.type==2?(s(),T("div",oe,[(s(!0),T(M,null,R(e.row.data,(l,V)=>(s(),T("p",{style:{"word-wrap":"break-word"},key:V},o(a(r)("transaction."+l.name))+": "+o(l.value),1))),128))])):C("",!0),c(f),u("div",le,[e.row.events.length>0?(s(),h(F,{key:0},{default:n(()=>[(s(!0),T(M,null,R(e.row.events,(l,V)=>(s(),h(p,{key:V,timestamp:l.createTime,placement:"top"},{default:n(()=>[c(k,null,{default:n(()=>[u("h4",null,[m(o(a(r)("transaction.eventName"))+": ",1),c(I,{type:a(O)[l.eventName].tagType},{default:n(()=>[m(o(a(O)[l.eventName].name?a(r)("transaction."+a(O)[l.eventName].name):""),1)]),_:2},1032,["type"])]),u("p",re,[m(o(a(r)("transaction.eventFrom"))+": ",1),u("span",null,o(l.from),1)]),u("p",se,[m(o(a(r)("transaction.eventTransactionHash"))+": ",1),u("span",null,o(l.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):C("",!0)])]),_:1}),c(g,{label:a(r)("transaction.type")},{default:n(e=>[u("div",ce,[e.row.type==1?(s(),h(I,{key:0,type:"success"},{default:n(()=>[m(o(a(r)("transaction."+e.row.methodName)),1)]),_:2},1024)):C("",!0),e.row.type==2?(s(),h(I,{key:1,type:"warning"},{default:n(()=>[m(o(a(r)("transaction."+e.row.methodName)),1)]),_:2},1024)):C("",!0)])]),_:1},8,["label"]),c(g,{label:a(r)("transaction.value")},{default:n(e=>[u("div",ie,[u("span",null,o(e.row.value),1),u("span",de,o(e.row.tokenSymbol),1)])]),_:1},8,["label"]),c(g,{label:a(r)("assets.operation")},{default:n(e=>[c(B,{trigger:"click"},{dropdown:n(()=>[c(x,null,{default:n(()=>[e.row.confirmStatus?C("",!0):(s(),h(v,{key:0,onClick:l=>j(e.row)},{default:n(()=>[m(o(a(r)("transaction.btnConfirm")),1)]),_:2},1032,["onClick"])),e.row.confirmStatus?C("",!0):(s(),h(v,{key:1,onClick:l=>J(e.row)},{default:n(()=>[m(o(a(r)("transaction.btnRevoke")),1)]),_:2},1032,["onClick"])),c(v,{onClick:l=>z(e.row),divided:!e.row.confirmStatus},{default:n(()=>[m(o(a(r)("transaction.btnExecute")),1)]),_:2},1032,["onClick","divided"])]),_:2},1024)]),default:n(()=>[c(P,{icon:a(q),class:"text-[24px]"},null,8,["icon"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[w,_.value]])])}}});export{he as _};
