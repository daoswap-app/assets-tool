import{t as u,w as Y}from"./___vite-browser-external_commonjs-proxy-17b6bc4b.js";import{c as Z,i as ee}from"./addresses-57ea0354.js";import{u as U}from"./web3Modal-6e074b71.js";import{g as q,W as z}from"./web3-a6b087d2.js";import{x as S,r as f,o as E,w as A,a7 as p,y as k,H as R,I as a,P as t,M as h,O as V,u as i,z as O,a0 as H,F as $,L as te,aa as le,A as ae,J as ne,S as j}from"./runtime-core.esm-bundler-c80a0204.js";import{u as se}from"./hooks-51d06512.js";import{u as F}from"./wallet-72ac7aac.js";import{_ as re}from"./WalletTable.vue_vue_type_style_index_0_lang-0d8cb9b6.js";const J=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"eventCreateWallet",type:"event"},{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"address[]",name:"_owners",type:"address[]"},{internalType:"uint256",name:"_required",type:"uint256"}],name:"createWallet",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAllWallet",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getWalletList",outputs:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"ownerCount",type:"uint256"},{internalType:"uint256",name:"threshold",type:"uint256"},{internalType:"address[]",name:"owners",type:"address[]"}],internalType:"struct Wallet.WalletItem[]",name:"walletList",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}],oe=S({__name:"AddWallet",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},emits:["update:visible","refresh-wallet-list"],setup(I,{emit:v}){const c=I,d=f(!1),m=f(!1),w=f(null),C=f(null),T={name:"1rens",owners:[],confirmNumber:1},x=f(),e=f(T);E(()=>{d.value=!0,w.value=U().getWallet,C.value=U().getWeb3,e.value.owners.push({address:w.value.address,error:""}),d.value=!1});const L=async()=>{const n=await x.value.validate(s=>!!s);let l=0;return e.value.owners.map(s=>{if(s.address){if(s.address&&(s.address=Z(s.address),!ee(s.address))){l++,s.error=u("wallet.invalid wallet address");return}const r=e.value.owners.filter(b=>b.address===s.address);if(r.length>1){const b=u("wallet.owner is already added");l++,s.error=b,r.map(W=>{W.error=b});return}else{l=l===0?0:l--,s.error="";return}}else{l++,s.error=u("wallet.please add owners");return}}),l<=0&&n},_=async()=>{if(await L()){d.value=!0;const l=[];e.value.owners.map(r=>{l.push(r.address)}),q(J,z[w.value.chainId],C.value).methods.createWallet(e.value.name,l,e.value.confirmNumber).send({from:w.value.address}).then(()=>{v("refresh-wallet-list")}).catch(r=>{console.error(r)}).finally(()=>{d.value=!1,g()})}},y=n=>{const l=e.value.owners.indexOf(n);l!==-1&&e.value.owners.splice(l,1)},D=()=>{const n={name:"",address:"",error:""};e.value.owners.push(n)},g=()=>{m.value=!1};return A(()=>m.value,n=>{v("update:visible",n)}),A(()=>c.visible,n=>{m.value=n}),A(()=>c.data,n=>{d.value=!0,n?(e.value.name=n.name,e.value.confirmNumber=n.threshold,e.value.owners=[],n.owners.map(l=>{e.value.owners.push({address:l,error:""})})):e.value=T,d.value=!1}),A(()=>e.value.owners.length,n=>{e.value.confirmNumber>e.value.owners.length&&(e.value.confirmNumber=n)}),(n,l)=>{const s=p("el-input"),r=p("el-col"),b=p("el-row"),W=p("el-form-item"),N=p("el-button"),P=p("el-divider"),G=p("el-option"),K=p("el-select"),Q=p("el-form"),X=p("el-dialog");return k(),R(X,{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=o=>m.value=o),title:i(u)("wallet.createWallet"),width:"90%",draggable:"","close-on-click-modal":!1,"before-close":g},{footer:a(()=>[t(N,{loading:d.value,onClick:g},{default:a(()=>[h(V(i(u)("wallet.btnCancel")),1)]),_:1},8,["loading"]),t(N,{loading:d.value,type:"primary",onClick:_},{default:a(()=>[h(V(i(u)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:a(()=>[t(Q,{ref_key:"walletFormRef",ref:x,model:e.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:a(()=>[t(W,{prop:"name",label:i(u)("wallet.name"),style:{width:"100%"},rules:[{required:!0,message:i(u)("wallet.please input wallet name"),trigger:"blur"}]},{default:a(()=>[t(b,{gutter:20,style:{width:"100%"}},{default:a(()=>[t(r,{span:24},{default:a(()=>[t(s,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.name=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),t(W,{prop:"owners",label:i(u)("wallet.owners"),style:{width:"100%"}},{default:a(()=>[(k(!0),O($,null,H(e.value.owners,(o,M)=>(k(),R(W,{style:{width:"100%","margin-bottom":"1.2rem"},key:M,error:o.error},{default:a(()=>[t(b,{gutter:10,style:{width:"100%"}},{default:a(()=>[t(r,{xs:4,md:1},{default:a(()=>[h(V(M+1),1)]),_:2},1024),t(r,{xs:14,md:19},{default:a(()=>[t(s,{modelValue:o.address,"onUpdate:modelValue":B=>o.address=B,onBlur:l[1]||(l[1]=B=>L())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{xs:6,md:4},{default:a(()=>[M!==0?(k(),R(N,{key:0,onClick:Y(B=>y(o),["prevent"])},{default:a(()=>[h("删除")]),_:2},1032,["onClick"])):te("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["error"]))),128))]),_:1},8,["label"]),t(W,null,{default:a(()=>[t(N,{type:"primary",onClick:D},{default:a(()=>[h(V(i(u)("wallet.btnAddOwner")),1)]),_:1})]),_:1}),t(P),t(W,{prop:"confirmNumber",label:i(u)("wallet.confirmNumber"),style:{width:"100%"},rules:[{required:!0,message:i(u)("wallet.please select confirm number"),trigger:"change"}]},{default:a(()=>[t(b,{gutter:20,style:{width:"100%"}},{default:a(()=>[t(r,{span:2},{default:a(()=>[t(K,{modelValue:e.value.confirmNumber,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.confirmNumber=o)},{default:a(()=>[(k(!0),O($,null,H(e.value.owners.length,o=>(k(),R(G,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{span:1},{default:a(()=>[h("/")]),_:1}),t(r,{span:2},{default:a(()=>[h(V(e.value.owners.length),1)]),_:1}),t(r,{span:19})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ue={width:24,height:24,body:'<path fill="currentColor" d="M11 11V7h2v4h4v2h-4v4h-2v-4H7v-2h4zm1 11C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/>'},de=ue,ie={class:"main"},ce={class:"w-full flex justify-between mb-4"},me=S({name:"HomeWallet"}),ge=S({...me,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null}},setup(I){const v=I,c=f([]),d=f(!0),m=f(null),w=async()=>{try{const y=await q(J,z[v.connectedWallet.chainId],v.web3).methods.getWalletList().call({from:v.connectedWallet.address});c.value=y,c.value.length>0?m.value?c.value.filter(g=>g.token.toLowerCase()===m.value.toLowerCase()).length<=0&&(F().setDefaultWallet(c.value[0].token),m.value=c.value[0].token):(F().setDefaultWallet(c.value[0].token),m.value=c.value[0].token):F().removeDefaultWallet()}catch{}finally{d.value=!1}},C=f(!1),T=f(null),x=_=>{C.value=!0,j(()=>{T.value=_??null})},e=_=>{j(()=>{d.value=!0,F().setDefaultWallet(_.token),w()})},L=()=>{w()};return E(()=>{w()}),(_,y)=>{const D=p("el-button"),g=le("loading");return k(),O("div",ie,[ae("div",ce,[t(D,{icon:i(se)(i(de)),onClick:y[0]||(y[0]=n=>x())},{default:a(()=>[h(V(i(u)("wallet.btnAdd")),1)]),_:1},8,["icon"])]),ne(t(re,{data:c.value,connectedWallet:v.connectedWallet,web3:v.web3,currentWallet:m.value,onChangeWallet:e,onRefreshWalletList:L},null,8,["data","connectedWallet","web3","currentWallet"]),[[g,d.value]]),t(oe,{visible:C.value,"onUpdate:visible":y[1]||(y[1]=n=>C.value=n),data:T.value,onRefreshWalletList:L},null,8,["visible","data"])])}}});export{ge as _};
