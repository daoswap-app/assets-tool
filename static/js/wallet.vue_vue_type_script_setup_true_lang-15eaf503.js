import{t as f,w as oe,v as Q}from"./i18n-c677edf9.js";import re from"./Card-975b48cd.js";import{c as se,i as ue}from"./addresses-c9475005.js";import{u as X}from"./web3Modal-5d682f0d.js";import{g as q,u as z,M as ie}from"./web3-e5e8a9e8.js";import{a as Y}from"./chains-54826113.js";import{x as G,r as _,o as ee,w as N,a7 as u,aa as le,y as w,H as W,I as o,J as T,M as h,O as x,u as v,P as l,z as A,a0 as J,F as B,L as te,A as de,S as Z}from"./runtime-core.esm-bundler-c80a0204.js";import{u as ce}from"./hooks-51d06512.js";const ae={[Y.localhost]:"0x31B48B6484c7D93f43a3838652A86b18740E37C6",[Y.bnbt]:"0x9A1C2faaf24D44A1d131A955D0046054Fa1AC832"},ne=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"eventCreateWallet",type:"event"},{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"address[]",name:"_owners",type:"address[]"},{internalType:"uint256",name:"_required",type:"uint256"}],name:"createWallet",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAllWallet",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getWalletList",outputs:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"ownerCount",type:"uint256"},{internalType:"uint256",name:"threshold",type:"uint256"},{internalType:"address[]",name:"owners",type:"address[]"}],internalType:"struct Wallet.WalletItem[]",name:"walletList",type:"tuple[]"}],stateMutability:"nonpayable",type:"function"}],me=G({__name:"AddWallet",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},emits:["update:visible"],setup(F,{emit:L}){const D=F,t=_(!1),i=_(!1),g=_(null),y=_(null),C=_(!0),k={name:"1rens",owners:[],confirmNumber:1},S=_(),e=_(k);ee(()=>{t.value=!0,g.value=X().getWallet,y.value=X().getWeb3,e.value.owners.push({address:g.value.address,error:""}),t.value=!1});const I=async()=>{const a=await S.value.validate(r=>!!r);let n=0;return e.value.owners.map(r=>{if(r.address){if(r.address&&(r.address=se(r.address),!ue(r.address))){n++,r.error=f("wallet.invalid wallet address");return}const s=e.value.owners.filter(c=>c.address===r.address);if(s.length>1){const c=f("wallet.owner is already added");n++,r.error=c,s.map(b=>{b.error=c});return}else{n=n===0?0:n--,r.error="";return}}else{n++,r.error=f("wallet.please add owners");return}}),n<=0&&a},O=async()=>{if(await I()){t.value=!0;const n=[];if(e.value.owners.map(r=>{n.push(r.address)}),C.value)q(ne,ae[g.value.chainId],y.value).methods.createWallet(e.value.name,n,e.value.confirmNumber).send({from:g.value.address}).then(s=>{console.info(s)}).catch(s=>{console.error(s)}).finally(()=>{t.value=!1,d()});else{const r=z().getWallet;q(ie,r,y.value).methods.createWallet(e.value.name,n,e.value.confirmNumber).send({from:g.value.address}).then(c=>{console.info(c)}).catch(c=>{console.error(c)}).finally(()=>{t.value=!1,d()})}}},M=a=>{const n=e.value.owners.indexOf(a);n!==-1&&e.value.owners.splice(n,1)},R=()=>{const a={name:"",address:"",error:""};e.value.owners.push(a)},d=()=>{i.value=!1};return N(()=>i.value,a=>{L("update:visible",a)}),N(()=>D.visible,a=>{i.value=a}),N(()=>D.data,a=>{t.value=!0,a?(C.value=!1,e.value.name=a.name,e.value.confirmNumber=a.threshold,e.value.owners=[],a.owners.map(n=>{e.value.owners.push({address:n,error:""})})):(C.value=!0,e.value=k),t.value=!1}),N(()=>e.value.owners.length,a=>{e.value.confirmNumber>e.value.owners.length&&(e.value.confirmNumber=a)}),(a,n)=>{const r=u("el-input"),s=u("el-col"),c=u("el-row"),b=u("el-form-item"),V=u("el-button"),U=u("el-divider"),j=u("el-option"),E=u("el-select"),m=u("el-form"),H=u("el-dialog"),K=le("loading");return w(),W(H,{modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=p=>i.value=p),title:v(f)(C.value?"wallet.createWallet":"wallet.modifyWallet"),width:"90%",draggable:"","close-on-click-modal":!1,"before-close":d},{footer:o(()=>[T((w(),W(V,{onClick:d},{default:o(()=>[h(x(v(f)("wallet.btnCancel")),1)]),_:1})),[[K,t.value]]),T((w(),W(V,{type:"primary",onClick:O},{default:o(()=>[h(x(v(f)("wallet.btnSubmit")),1)]),_:1})),[[K,t.value]])]),default:o(()=>[l(m,{ref_key:"walletFormRef",ref:S,model:e.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:o(()=>[l(b,{prop:"name",label:v(f)("wallet.name"),style:{width:"100%"},rules:[{required:!0,message:v(f)("wallet.please input wallet name"),trigger:"blur"}]},{default:o(()=>[l(c,{gutter:20,style:{width:"100%"}},{default:o(()=>[l(s,{span:24},{default:o(()=>[l(r,{modelValue:e.value.name,"onUpdate:modelValue":n[0]||(n[0]=p=>e.value.name=p)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),l(b,{prop:"owners",label:v(f)("wallet.owners"),style:{width:"100%"}},{default:o(()=>[(w(!0),A(B,null,J(e.value.owners,(p,P)=>(w(),W(b,{style:{width:"100%","margin-bottom":"1.2rem"},key:P,error:p.error},{default:o(()=>[l(c,{gutter:10,style:{width:"100%"}},{default:o(()=>[l(s,{xs:4,md:1},{default:o(()=>[h(x(P+1),1)]),_:2},1024),l(s,{xs:14,md:19},{default:o(()=>[l(r,{modelValue:p.address,"onUpdate:modelValue":$=>p.address=$,onBlur:n[1]||(n[1]=$=>I())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(s,{xs:6,md:4},{default:o(()=>[P!==0?(w(),W(V,{key:0,onClick:oe($=>M(p),["prevent"])},{default:o(()=>[h("删除")]),_:2},1032,["onClick"])):te("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["error"]))),128))]),_:1},8,["label"]),l(b,null,{default:o(()=>[l(V,{type:"primary",onClick:R},{default:o(()=>[h(x(v(f)("wallet.btnAddOwner")),1)]),_:1})]),_:1}),l(U),l(b,{prop:"confirmNumber",label:v(f)("wallet.confirmNumber"),style:{width:"100%"},rules:[{required:!0,message:v(f)("wallet.please select confirm number"),trigger:"change"}]},{default:o(()=>[l(c,{gutter:20,style:{width:"100%"}},{default:o(()=>[l(s,{span:2},{default:o(()=>[l(E,{modelValue:e.value.confirmNumber,"onUpdate:modelValue":n[2]||(n[2]=p=>e.value.confirmNumber=p)},{default:o(()=>[(w(!0),A(B,null,J(e.value.owners.length,p=>(w(),W(j,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{span:1},{default:o(()=>[h("/")]),_:1}),l(s,{span:2},{default:o(()=>[h(x(e.value.owners.length),1)]),_:1}),l(s,{span:19})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),pe={width:1024,height:1024,body:'<path fill="currentColor" d="m795.904 750.72l124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704a352 352 0 0 0 0 704z"/>'},fe=pe,ve={width:24,height:24,body:'<path fill="currentColor" d="M11 11V7h2v4h4v2h-4v4h-2v-4H7v-2h4zm1 11C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/>'},_e=ve,we={class:"main"},ge={class:"w-full flex justify-between mb-4"},ye=G({name:"HomeWallet"}),Le=G({...ye,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null}},setup(F){const L=F,D=`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `,t=_({current:1,pageSize:12,total:0}),i=_([]),g=_(!0),y=_(null),C=async()=>{try{const a=await q(ne,ae[L.connectedWallet.chainId],L.web3).methods.getWalletList().call({from:L.connectedWallet.address});i.value=a,i.value.length>0?y.value?i.value.filter(r=>r.token.toLowerCase()===y.value.toLowerCase()).length<=0&&(z().setDefaultWallet(i.value[0].token),y.value=i.value[0].token):(z().setDefaultWallet(i.value[0].token),y.value=i.value[0].token):z().removeDefaultWallet(),t.value={...t.value,total:i.value.length}}catch{}finally{setTimeout(()=>{g.value=!1},500)}};ee(()=>{C()});const k=_(!1),S=_(null),e=_(""),I=d=>{t.value.pageSize=d,t.value.current=1},O=d=>{t.value.current=d},M=d=>{k.value=!0,Z(()=>{S.value=d??null})},R=d=>{Z(()=>{g.value=!0,z().setDefaultWallet(d.token),t.value.total=0,C()})};return(d,a)=>{const n=u("el-button"),r=u("IconifyIconOffline"),s=u("el-icon"),c=u("el-input"),b=u("el-empty"),V=u("el-col"),U=u("el-row"),j=u("el-pagination"),E=le("loading");return w(),A("div",we,[de("div",ge,[l(n,{icon:v(ce)(v(_e)),onClick:a[0]||(a[0]=m=>M())},{default:o(()=>[h(x(v(f)("wallet.btnAdd")),1)]),_:1},8,["icon"]),l(c,{style:{width:"300px"},modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=m=>e.value=m),placeholder:v(f)("wallet.address"),clearable:""},{suffix:o(()=>[l(s,{class:"el-input__icon"},{default:o(()=>[T(l(r,{icon:v(fe)},null,8,["icon"]),[[Q,e.value.length===0]])]),_:1})]),_:1},8,["modelValue","placeholder"])]),T((w(),A("div",{"element-loading-svg":D,"element-loading-svg-view-box":"-10, -10, 50, 50"},[T(l(b,{description:"暂无数据"},null,512),[[Q,i.value.slice(t.value.pageSize*(t.value.current-1),t.value.pageSize*t.value.current).filter(m=>m.name.toLowerCase().includes(e.value.toLowerCase())).length===0]]),t.value.total>0?(w(),A(B,{key:0},[l(U,{gutter:16},{default:o(()=>[(w(!0),A(B,null,J(i.value.slice(t.value.pageSize*(t.value.current-1),t.value.pageSize*t.value.current).filter(m=>m.name.toLowerCase().includes(e.value.toLowerCase())),(m,H)=>(w(),W(V,{key:H,xs:24,sm:12,md:8,lg:6,xl:4},{default:o(()=>[l(re,{wallet:m,"default-wallet":y.value,onManageWallet:M,onChangeWallet:R},null,8,["wallet","default-wallet"])]),_:2},1024))),128))]),_:1}),l(j,{class:"float-right",currentPage:t.value.current,"onUpdate:currentPage":a[2]||(a[2]=m=>t.value.current=m),"page-size":t.value.pageSize,total:t.value.total,"page-sizes":[12,24,36],background:!0,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:O},null,8,["currentPage","page-size","total"])],64)):te("",!0)])),[[E,g.value]]),l(me,{visible:k.value,"onUpdate:visible":a[3]||(a[3]=m=>k.value=m),data:S.value},null,8,["visible","data"])])}}});export{Le as _};
