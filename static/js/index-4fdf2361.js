import{t as r}from"./___vite-browser-external_commonjs-proxy-1cc6769e.js";import{u as S}from"./web3Modal-1af828a3.js";import{f as H}from"./formatters-ef726bbc.js";import{c as Q,i as X}from"./addresses-e86418e1.js";import{u as B}from"./wallet-9c0d2eaa.js";import{g as D,M as Y,e as j,T as Z}from"./web3-125a0c04.js";import{E as z}from"./ERC20_abi-801f43f8.js";import{x as M,r as i,o as P,w as R,a7 as u,y as V,H as F,I as e,P as t,M as I,O as k,u as m,z as $,a0 as ee,F as te,aa as ae,A as y,J as le,L as se}from"./runtime-core.esm-bundler-c80a0204.js";import{g as ne,h as oe}from"./chains-f720db1d.js";import"./vue-i18n.runtime.esm-bundler-d653d868.js";import"./web3.min-9566e482.js";import"./index-4df69d29.js";import"./vue-router-935545c9.js";import"./utils-52a1a606.js";const re=M({__name:"SendTransaction",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null},tokenList:{type:Object,default:()=>[]}},emits:["update:visible","refresh-asset-list"],setup(N,{emit:T}){const b=N,v=i(!1),p=i(!1),h=i(""),A=i(null),g=i(null),C={sendAddress:"",recipientAddress:"",assetToken:"",amount:""},W=i(),a=i(C);P(()=>{h.value=B().getWallet,A.value=S().getWallet,g.value=S().getWeb3,a.value.sendAddress=h.value});const E=(n,s,l)=>{s===""?l(new Error(r("transaction.please input recipient address"))):(a.value.recipientAddress=Q(a.value.recipientAddress),X(a.value.recipientAddress)?l():l(new Error(r("transaction.invalid recipient address"))))},L=(n,s,l)=>{s===""?l(new Error(r("transaction.please input amount"))):parseFloat(s)>parseFloat(b.data.balance)?l(new Error(r("transaction.exceed balance"))):l()},_=async()=>await W.value.validate(n=>!!n),w=async()=>{if(await _()){v.value=!0;const s=D(Y,B().getWallet,g.value),l={destination:a.value.recipientAddress,value:j(a.value.amount,g.value),data:"0x"};if(a.value.assetToken){const c=D(z,a.value.assetToken,g.value),o=j(a.value.amount,g.value),x=await c.methods.transfer(a.value.recipientAddress,o).encodeABI();l.destination=a.value.assetToken,l.value="0",l.data=x}s.methods.submitTransaction(l.destination,l.value,l.data).send({from:A.value.address}).then(()=>{T("refresh-asset-list")}).catch(c=>{console.error(c)}).finally(()=>{v.value=!1,f()})}},f=()=>{p.value=!1};return R(()=>p.value,n=>{T("update:visible",n)}),R(()=>b.visible,n=>{p.value=n}),R(()=>b.data,n=>{a.value.assetToken=n?n.token:""}),(n,s)=>{const l=u("el-col"),c=u("el-row"),o=u("el-form-item"),x=u("el-divider"),O=u("el-input"),q=u("el-option"),J=u("el-select"),K=u("el-form"),U=u("el-button"),G=u("el-dialog");return V(),F(G,{modelValue:p.value,"onUpdate:modelValue":s[3]||(s[3]=d=>p.value=d),title:m(r)("transaction.sendTokens"),width:"80%",draggable:"","close-on-click-modal":!1,"before-close":f},{footer:e(()=>[t(U,{loading:v.value,onClick:f},{default:e(()=>[I(k(m(r)("wallet.btnCancel")),1)]),_:1},8,["loading"]),t(U,{loading:v.value,type:"primary",onClick:w},{default:e(()=>[I(k(m(r)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:e(()=>[t(K,{ref_key:"transactionFormRef",ref:W,model:a.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:e(()=>[t(o,{prop:"sendAddress",label:m(r)("transaction.sendAddress"),style:{width:"100%"}},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[I(k(a.value.sendAddress),1)]),_:1})]),_:1})]),_:1},8,["label"]),t(x),t(o,{prop:"recipientAddress",label:m(r)("transaction.recipientAddress"),style:{width:"100%"},rules:[{validator:E,trigger:"blur"}]},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(O,{modelValue:a.value.recipientAddress,"onUpdate:modelValue":s[0]||(s[0]=d=>a.value.recipientAddress=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),t(o,{prop:"assetToken",label:m(r)("transaction.assetToken"),style:{width:"100%"}},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(J,{modelValue:a.value.assetToken,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value.assetToken=d),style:{width:"100%"}},{default:e(()=>[(V(!0),$(te,null,ee(b.tokenList,d=>(V(),F(q,{key:d.token,label:d.symbol+(d.token?" - "+d.token:""),value:d.token},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label"]),t(o,{prop:"amount",label:m(r)("transaction.amount"),style:{width:"100%"},rules:[{validator:L,trigger:"blur"}]},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(O,{modelValue:a.value.amount,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value.amount=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ie={class:"card-header"},ue={class:"font-medium"},de={style:{display:"flex","align-items":"left"}},ce=y("i",{class:"el-icon-time"},null,-1),me={style:{"margin-left":"10px"}},pe={style:{display:"flex","align-items":"left"}},fe={style:{"margin-left":"3px"}},ve=M({name:"Assets"}),Be=M({...ve,setup(N){const T=i([]),b=i(!1),v=i(null),p=i(null),h=i([]),A=i(!1),g=i(null),C=i(null);async function W(){p.value=B().getWallet,v.value=S().getWeb3;const _=await v.value.eth.getChainId();Z[_].map(w=>{T.value.push(w.token)}),C.value=ne(oe(parseInt(_)))}const a=async()=>{if(b.value=!0,h.value=[],p.value){const _=await v.value.eth.getBalance(p.value);h.value.push({symbol:C.value.token,token:"",balance:H(_,18)});const w=T.value.map(async f=>{const n=D(z,f,v.value),s=await n.methods.symbol().call(),l=await n.methods.decimals().call(),c=await n.methods.balanceOf(B().getWallet).call(),o={symbol:s,token:f,balance:H(c,l)};h.value.push(o)});await Promise.all(w)}b.value=!1};P(()=>{W(),a()});const E=_=>{A.value=!0,g.value=_},L=()=>{a()};return(_,w)=>{const f=u("el-table-column"),n=u("el-button"),s=u("el-table"),l=u("el-card"),c=ae("loading");return V(),$("div",null,[t(l,{shadow:"never"},{header:e(()=>[y("div",ie,[y("span",ue,k(m(r)("assets.assets")+" - "+p.value),1)])]),default:e(()=>[le((V(),F(s,{data:h.value,style:{width:"100%"}},{default:e(()=>[t(f,{label:m(r)("assets.asset")},{default:e(o=>[y("div",de,[ce,y("span",me,k(o.row.symbol),1)])]),_:1},8,["label"]),t(f,{label:m(r)("assets.balance")},{default:e(o=>[y("div",pe,[y("span",null,k(o.row.balance),1),y("span",fe,k(o.row.symbol),1)])]),_:1},8,["label"]),t(f,{label:m(r)("assets.operation")},{default:e(o=>[o.row.balance>0?(V(),F(n,{key:0,type:"primary",size:"small",onClick:x=>E(o.row)},{default:e(()=>[I(k(m(r)("wallet.btnSend")),1)]),_:2},1032,["onClick"])):se("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[c,b.value]])]),_:1}),t(re,{visible:A.value,"onUpdate:visible":w[0]||(w[0]=o=>A.value=o),data:g.value,tokenList:h.value,onRefreshAssetList:L},null,8,["visible","data","tokenList"])])}}});export{Be as default};
