import{E as l}from"./___vite-browser-external_commonjs-proxy-7f1f402a.js";import{A as q}from"./arrow-down-s-line-da487a0d.js";import{g as S,M as E,E as G,a as O}from"./web3-62625531.js";import{d as K,a as U,p as X,c as A}from"./decodeParams-f5fdd745.js";import{B as Y}from"./ButtonOfCopy-9be7905e.js";import{i as Z}from"./chains-85289d49.js";import{x as Q,r as D,o as tt,a7 as i,aa as et,y as s,z as C,J as at,H as h,I as o,P as d,A as w,M as u,O as n,u as a,F as M,a0 as R,L as k}from"./runtime-core.esm-bundler-c80a0204.js";const nt={style:{"word-wrap":"break-word"}},ot={key:0},rt={key:1},lt={style:{"word-wrap":"break-word"}},st={class:"block"},ct={style:{"word-wrap":"break-word"}},it={style:{"word-wrap":"break-word"}},dt={style:{display:"flex","align-items":"left"}},ut=Q({name:"TransactionsQueue"}),ht=Q({...ut,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null},currentWallet:{type:String,default:""}},setup($){const e=$,m=D(!1),N=D([]),H=D(null),L=D(0),W=async()=>{m.value=!0;const c=S(E,e.currentWallet,e.web3);L.value=G[e.connectedWallet.chainId],N.value=[];const b=await c.methods.getTransactionIds(0).call(),_=await c.getPastEvents("allEvents",{filter:{transactionId:b},fromBlock:L.value,toBlock:"latest"}),I=b.map(async g=>{const f=await c.methods.getTransaction(g).call(),F=await c.methods.getTransactionConfirmationStatus(g,e.connectedWallet.address).call(),T=await e.web3.eth.getChainId();H.value=Z(T);const P={id:g,destination:f.to,tokenSymbol:"",value:null,data:null,confirmations:f.confirmations,revokes:f.revokes,executeState:f.state,confirmStatus:F,type:1,methodName:"",events:[]};let v=null;f.to.toLowerCase()===e.currentWallet.toLowerCase()?v=K(f):v=U(f,H.value,e.web3);const x={...P,...v},B=await _.filter(y=>{if(y.returnValues.transactionId&&y.returnValues.transactionId==g)return y});if(B.length>0){const y=B.map(async p=>{const t=await e.web3.eth.getTransaction(p.transactionHash),r={eventName:p.event,...p.returnValues,transactionHash:p.transactionHash,blockNumber:p.blockNumber,from:t.from,createTime:X(p.returnValues.createTime)};x.events.push(r)});await Promise.all(y),x.events.sort(A("blockNumber"))}N.value.push(x)});await Promise.all(I),N.value.sort(A("id")),m.value=!1};tt(()=>{e.connectedWallet&&e.web3&&e.currentWallet&&W()});const j=c=>{m.value=!0,S(E,e.currentWallet,e.web3).methods.confirmTransaction(c.id).send({from:e.connectedWallet.address}).then(async()=>{await W()}).catch(_=>{console.error(_)}).finally(()=>{m.value=!1})},z=c=>{m.value=!0,S(E,e.currentWallet,e.web3).methods.executeTransaction(c.id).send({from:e.connectedWallet.address}).then(async()=>{await W()}).catch(_=>{console.error(_)}).finally(()=>{m.value=!1})},J=c=>{m.value=!0,S(E,e.currentWallet,e.web3).methods.revokeTransaction(c.id).send({from:e.connectedWallet.address}).then(async()=>{await W()}).catch(_=>{console.error(_)}).finally(()=>{m.value=!1})};return(c,b)=>{const _=i("el-divider"),I=i("el-tag"),g=i("el-card"),f=i("el-timeline-item"),F=i("el-timeline"),T=i("el-table-column"),P=i("IconifyIconOffline"),v=i("el-dropdown-item"),x=i("el-dropdown-menu"),B=i("el-dropdown"),y=i("el-table"),p=et("loading");return s(),C("div",null,[at((s(),h(y,{data:N.value,style:{width:"100%"}},{default:o(()=>[d(T,{type:"expand"},{default:o(t=>[w("p",nt,[u(n(a(l)("transaction.destination"))+": ",1),d(Y,{text:t.row.destination},null,8,["text"])]),t.row.type==2?(s(),C("div",ot,[(s(!0),C(M,null,R(t.row.data,(r,V)=>(s(),C("p",{style:{"word-wrap":"break-word"},key:V},n(a(l)("transaction."+r.name))+": "+n(r.value),1))),128))])):k("",!0),t.row.type==1?(s(),C("div",rt,[w("p",lt,n(a(l)("transaction.amount"))+": "+n(t.row.value)+" "+n(t.row.tokenSymbol),1)])):k("",!0),d(_),w("div",st,[t.row.events.length>0?(s(),h(F,{key:0},{default:o(()=>[(s(!0),C(M,null,R(t.row.events,(r,V)=>(s(),h(f,{key:V,timestamp:r.createTime,placement:"top"},{default:o(()=>[d(g,null,{default:o(()=>[w("h4",null,[u(n(a(l)("transaction.eventName"))+": ",1),d(I,{type:a(O)[r.eventName].tagType},{default:o(()=>[u(n(a(O)[r.eventName].name?a(l)("transaction."+a(O)[r.eventName].name):""),1)]),_:2},1032,["type"])]),w("p",ct,[u(n(a(l)("transaction.eventFrom"))+": ",1),w("span",null,n(r.from),1)]),w("p",it,[u(n(a(l)("transaction.eventTransactionHash"))+": ",1),w("span",null,n(r.transactionHash),1)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:2},1024)):k("",!0)])]),_:1}),d(T,{label:a(l)("transaction.type")},{default:o(t=>[w("div",dt,[t.row.type==1?(s(),h(I,{key:0,type:"success"},{default:o(()=>[u(n(a(l)("transaction."+t.row.methodName)),1)]),_:2},1024)):k("",!0),t.row.type==2?(s(),h(I,{key:1,type:"warning"},{default:o(()=>[u(n(a(l)("transaction."+t.row.methodName)),1)]),_:2},1024)):k("",!0)])]),_:1},8,["label"]),d(T,{label:a(l)("assets.operation")},{default:o(t=>[d(B,{trigger:"click"},{dropdown:o(()=>[d(x,null,{default:o(()=>[t.row.confirmStatus?k("",!0):(s(),h(v,{key:0,onClick:r=>j(t.row)},{default:o(()=>[u(n(a(l)("transaction.btnConfirm")),1)]),_:2},1032,["onClick"])),t.row.confirmStatus?k("",!0):(s(),h(v,{key:1,onClick:r=>J(t.row)},{default:o(()=>[u(n(a(l)("transaction.btnRevoke")),1)]),_:2},1032,["onClick"])),d(v,{onClick:r=>z(t.row),divided:!t.row.confirmStatus},{default:o(()=>[u(n(a(l)("transaction.btnExecute")),1)]),_:2},1032,["onClick","divided"])]),_:2},1024)]),default:o(()=>[d(P,{icon:a(q),class:"text-[24px]"},null,8,["icon"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[p,m.value]])])}}});export{ht as _};
