import{t as r}from"./___vite-browser-external_commonjs-proxy-1cc6769e.js";import{u as S}from"./web3Modal-f511e92b.js";import{f as G}from"./formatters-ef726bbc.js";import{c as Q,i as X}from"./addresses-e86418e1.js";import{u as I}from"./wallet-e92210c4.js";import{g as D,M as Y,e as H,T as Z,w as ee}from"./web3-125a0c04.js";import{E as j}from"./ERC20_abi-801f43f8.js";import{x as M,r as i,o as z,w as R,a7 as u,y as V,H as B,I as e,P as t,M as F,O as k,u as m,z as P,a0 as te,F as ae,aa as le,A as y,J as se,L as oe}from"./runtime-core.esm-bundler-c80a0204.js";import{g as ne,h as re}from"./chains-f720db1d.js";import"./vue-i18n.runtime.esm-bundler-d653d868.js";import"./web3.min-9566e482.js";import"./index-fb93dc40.js";import"./vue-router-935545c9.js";import"./utils-52a1a606.js";const ie=M({__name:"SendTransaction",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null},tokenList:{type:Object,default:()=>[]}},emits:["update:visible","refresh-asset-list"],setup(N,{emit:T}){const b=N,p=i(!1),f=i(!1),h=i(""),A=i(null),g=i(null),C={sendAddress:"",recipientAddress:"",assetToken:"",amount:""},W=i(),a=i(C);z(()=>{h.value=I().getWallet,A.value=S().getWallet,g.value=S().getWeb3,a.value.sendAddress=h.value});const E=(o,s,l)=>{s===""?l(new Error(r("transaction.please input recipient address"))):(a.value.recipientAddress=Q(a.value.recipientAddress),X(a.value.recipientAddress)?l():l(new Error(r("transaction.invalid recipient address"))))},L=(o,s,l)=>{s===""?l(new Error(r("transaction.please input amount"))):parseFloat(s)>parseFloat(b.data.balance)?l(new Error(r("transaction.exceed balance"))):l()},_=async()=>await W.value.validate(o=>!!o),w=async()=>{if(await _()){p.value=!0;const s=D(Y,I().getWallet,g.value),l={destination:a.value.recipientAddress,value:H(a.value.amount,g.value),data:"0x"};if(a.value.assetToken){const c=D(j,a.value.assetToken,g.value),n=H(a.value.amount,g.value),x=await c.methods.transfer(a.value.recipientAddress,n).encodeABI();l.destination=a.value.assetToken,l.value="0",l.data=x}s.methods.submitTransaction(l.destination,l.value,l.data).send({from:A.value.address}).then(()=>{T("refresh-asset-list")}).catch(c=>{console.error(c)}).finally(()=>{p.value=!1,v()})}},v=()=>{f.value=!1};return R(()=>f.value,o=>{T("update:visible",o)}),R(()=>b.visible,o=>{f.value=o}),R(()=>b.data,o=>{a.value.assetToken=o?o.token:""}),(o,s)=>{const l=u("el-col"),c=u("el-row"),n=u("el-form-item"),x=u("el-divider"),O=u("el-input"),$=u("el-option"),q=u("el-select"),J=u("el-form"),U=u("el-button"),K=u("el-dialog");return V(),B(K,{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=d=>f.value=d),title:m(r)("transaction.sendTokens"),width:"80%",draggable:"","close-on-click-modal":!1,"before-close":v},{footer:e(()=>[t(U,{loading:p.value,onClick:v},{default:e(()=>[F(k(m(r)("wallet.btnCancel")),1)]),_:1},8,["loading"]),t(U,{loading:p.value,type:"primary",onClick:w},{default:e(()=>[F(k(m(r)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:e(()=>[t(J,{ref_key:"transactionFormRef",ref:W,model:a.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0},{default:e(()=>[t(n,{prop:"sendAddress",label:m(r)("transaction.sendAddress"),style:{width:"100%"}},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[F(k(a.value.sendAddress),1)]),_:1})]),_:1})]),_:1},8,["label"]),t(x),t(n,{prop:"recipientAddress",label:m(r)("transaction.recipientAddress"),style:{width:"100%"},rules:[{validator:E,trigger:"blur"}]},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(O,{modelValue:a.value.recipientAddress,"onUpdate:modelValue":s[0]||(s[0]=d=>a.value.recipientAddress=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),t(n,{prop:"assetToken",label:m(r)("transaction.assetToken"),style:{width:"100%"}},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(q,{modelValue:a.value.assetToken,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value.assetToken=d),style:{width:"100%"}},{default:e(()=>[(V(!0),P(ae,null,te(b.tokenList,d=>(V(),B($,{key:d.token,label:d.symbol+(d.token?" - "+d.token:""),value:d.token},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label"]),t(n,{prop:"amount",label:m(r)("transaction.amount"),style:{width:"100%"},rules:[{validator:L,trigger:"blur"}]},{default:e(()=>[t(c,{gutter:20,style:{width:"100%"}},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(O,{modelValue:a.value.amount,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value.amount=d)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ue={class:"card-header"},de={class:"font-medium"},ce={style:{display:"flex","align-items":"left"}},me=y("i",{class:"el-icon-time"},null,-1),pe={style:{"margin-left":"10px"}},fe={style:{display:"flex","align-items":"left"}},ve={style:{"margin-left":"3px"}},_e=M({name:"Assets"}),Be=M({..._e,setup(N){const T=i([]),b=i(!1),p=i(null),f=i(null),h=i([]),A=i(!1),g=i(null),C=i(null);async function W(){f.value=I().getWallet,p.value=S().getWeb3;const _=await p.value.eth.getChainId();Z[_].map(w=>{T.value.push(w.token)}),C.value=ne(re(parseInt(_)))}const a=async()=>{if(b.value=!0,h.value=[],f.value){const _=await p.value.eth.getBalance(f.value);h.value.push({symbol:C.value.token,token:"",balance:ee(_,p.value)});const w=T.value.map(async v=>{const o=D(j,v,p.value),s=await o.methods.symbol().call(),l=await o.methods.decimals().call(),c=await o.methods.balanceOf(I().getWallet).call(),n={symbol:s,token:v,balance:G(c,l)};h.value.push(n)});await Promise.all(w)}b.value=!1};z(()=>{W(),a()});const E=_=>{A.value=!0,g.value=_},L=()=>{a()};return(_,w)=>{const v=u("el-table-column"),o=u("el-button"),s=u("el-table"),l=u("el-card"),c=le("loading");return V(),P("div",null,[t(l,{shadow:"never"},{header:e(()=>[y("div",ue,[y("span",de,k(m(r)("assets.assets")+" - "+f.value),1)])]),default:e(()=>[se((V(),B(s,{data:h.value,style:{width:"100%"}},{default:e(()=>[t(v,{label:m(r)("assets.asset")},{default:e(n=>[y("div",ce,[me,y("span",pe,k(n.row.symbol),1)])]),_:1},8,["label"]),t(v,{label:m(r)("assets.balance")},{default:e(n=>[y("div",fe,[y("span",null,k(n.row.balance),1),y("span",ve,k(n.row.symbol),1)])]),_:1},8,["label"]),t(v,{label:m(r)("assets.operation")},{default:e(n=>[parseFloat(n.row.balance)>0?(V(),B(o,{key:0,type:"primary",size:"small",onClick:x=>E(n.row)},{default:e(()=>[F(k(m(r)("wallet.btnSend")),1)]),_:2},1032,["onClick"])):oe("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[c,b.value]])]),_:1}),t(ie,{visible:A.value,"onUpdate:visible":w[0]||(w[0]=n=>A.value=n),data:g.value,tokenList:h.value,onRefreshAssetList:L},null,8,["visible","data","tokenList"])])}}});export{Be as default};
