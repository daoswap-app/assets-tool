import{E as u,w as X}from"./___vite-browser-external_commonjs-proxy-eabcf697.js";import{c as Y,i as Z}from"./addresses-868f69ee.js";import{u as E}from"./web3Modal-c60dd81a.js";import{W as $,u as L}from"./Wallet_abi-c08defda.js";import{g as j,W as z}from"./web3-5746e9c3.js";import{x as U,r as v,o as q,w as F,a7 as f,y as k,H as B,I as a,P as l,M as g,O as C,u as i,z as M,a0 as H,F as T,L as ee,aa as le,A as te,J as ae,S as oe}from"./runtime-core.esm-bundler-c80a0204.js";import{u as re}from"./hooks-51d06512.js";import{_ as ne}from"./WalletTable.vue_vue_type_style_index_0_lang-34c64b15.js";const se=U({__name:"AddWallet",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>null}},emits:["update:visible","refresh-wallet-list"],setup(I,{emit:p}){const c=I,m=v(!1),d=v(!1),w=v(null),V=v(null),x={name:"1rens",owners:[],confirmNumber:1},N=v(),e=v(x);q(()=>{m.value=!0,w.value=E().getWallet,V.value=E().getWeb3,e.value.owners.push({address:w.value.address,error:""}),m.value=!1});const D=async()=>{const o=await N.value.validate(r=>!!r);let t=0;return e.value.owners.map(r=>{if(r.address){if(r.address&&(r.address=Y(r.address),!Z(r.address))){t++,r.error=u("wallet.invalid wallet address");return}const n=e.value.owners.filter(h=>h.address===r.address);if(n.length>1){const h=u("wallet.owner is already added");t++,r.error=h,n.map(y=>{y.error=h});return}else{t=t===0?0:t--,r.error="";return}}else{t++,r.error=u("wallet.please add owners");return}}),t<=0&&o},_=async()=>{if(await D()){m.value=!0;const t=[];e.value.owners.map(n=>{t.push(n.address)}),j($,z[w.value.chainId],V.value).methods.createWallet(e.value.name,t,e.value.confirmNumber).send({from:w.value.address}).then(()=>{p("refresh-wallet-list")}).catch(n=>{console.error(n)}).finally(()=>{m.value=!1,W()})}},b=o=>{const t=e.value.owners.indexOf(o);t!==-1&&e.value.owners.splice(t,1)},A=()=>{const o={name:"",address:"",error:""};e.value.owners.push(o)},W=()=>{d.value=!1};return F(()=>d.value,o=>{p("update:visible",o)}),F(()=>c.visible,o=>{d.value=o}),F(()=>c.data,o=>{m.value=!0,o?(e.value.name=o.name,e.value.confirmNumber=o.threshold,e.value.owners=[],o.owners.map(t=>{e.value.owners.push({address:t,error:""})})):e.value=x,m.value=!1}),F(()=>e.value.owners.length,o=>{e.value.confirmNumber>e.value.owners.length&&(e.value.confirmNumber=o)}),(o,t)=>{const r=f("el-input"),n=f("el-col"),h=f("el-row"),y=f("el-form-item"),R=f("el-button"),J=f("el-divider"),P=f("el-option"),G=f("el-select"),K=f("el-form"),Q=f("el-dialog");return k(),B(Q,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=s=>d.value=s),title:i(u)("wallet.createWallet"),width:"90%",draggable:"","close-on-click-modal":!1,"before-close":W},{footer:a(()=>[l(R,{loading:m.value,onClick:W},{default:a(()=>[g(C(i(u)("wallet.btnCancel")),1)]),_:1},8,["loading"]),l(R,{loading:m.value,type:"primary",onClick:_},{default:a(()=>[g(C(i(u)("wallet.btnSubmit")),1)]),_:1},8,["loading"])]),default:a(()=>[l(K,{ref_key:"walletFormRef",ref:N,model:e.value,"label-width":"100px",class:"demo-ruleForm","hide-required-asterisk":!0,"label-position":"top"},{default:a(()=>[l(y,{prop:"name",label:i(u)("wallet.name"),style:{width:"100%"},rules:[{required:!0,message:i(u)("wallet.please input wallet name"),trigger:"blur"}]},{default:a(()=>[l(h,{gutter:20,style:{width:"100%"}},{default:a(()=>[l(n,{span:24},{default:a(()=>[l(r,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value.name=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["label","rules"]),l(y,{prop:"owners",label:i(u)("wallet.owners"),style:{width:"100%"}},{default:a(()=>[(k(!0),M(T,null,H(e.value.owners,(s,O)=>(k(),B(y,{style:{width:"100%","margin-bottom":"1.2rem"},key:O,error:s.error},{default:a(()=>[l(h,{gutter:10,style:{width:"100%"}},{default:a(()=>[l(n,{xs:1,md:1},{default:a(()=>[g(C(O+1),1)]),_:2},1024),l(n,{xs:17,md:19},{default:a(()=>[l(r,{modelValue:s.address,"onUpdate:modelValue":S=>s.address=S,onBlur:t[1]||(t[1]=S=>D())},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{xs:6,md:4},{default:a(()=>[O!==0?(k(),B(R,{key:0,onClick:X(S=>b(s),["prevent"])},{default:a(()=>[g("删除")]),_:2},1032,["onClick"])):ee("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["error"]))),128))]),_:1},8,["label"]),l(y,null,{default:a(()=>[l(R,{type:"primary",onClick:A},{default:a(()=>[g(C(i(u)("wallet.btnAddOwner")),1)]),_:1})]),_:1}),l(J),l(y,{prop:"confirmNumber",label:i(u)("wallet.confirmNumber"),style:{width:"100%"},rules:[{required:!0,message:i(u)("wallet.please select confirm number"),trigger:"change"}]},{default:a(()=>[l(h,{gutter:20,style:{width:"100%"}},{default:a(()=>[l(n,{xs:8,md:2},{default:a(()=>[l(G,{modelValue:e.value.confirmNumber,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.confirmNumber=s)},{default:a(()=>[(k(!0),M(T,null,H(e.value.owners.length,s=>(k(),B(P,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{xs:1,md:1},{default:a(()=>[g("/")]),_:1}),l(n,{xs:8,md:2},{default:a(()=>[g(C(e.value.owners.length),1)]),_:1}),l(n,{xs:7,md:19})]),_:1})]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ue={width:24,height:24,body:'<path fill="currentColor" d="M11 11V7h2v4h4v2h-4v4h-2v-4H7v-2h4zm1 11C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10zm0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16z"/>'},de=ue,ie={class:"main"},ce={class:"w-full flex justify-between mb-4"},me=U({name:"HomeWallet"}),We=U({...me,props:{connectedWallet:{type:Object,default:null},web3:{type:Object,default:null}},setup(I){const p=I,c=v([]),m=v(!0),d=v(null),w=async()=>{try{d.value=L().getWallet;const b=await j($,z[p.connectedWallet.chainId],p.web3).methods.getWalletList().call({from:p.connectedWallet.address});c.value=b,c.value.length>0?d.value?c.value.filter(W=>W.token.toLowerCase()===d.value.toLowerCase()).length<=0&&(L().setDefaultWallet(c.value[0].token),d.value=c.value[0].token):(L().setDefaultWallet(c.value[0].token),d.value=c.value[0].token):L().removeDefaultWallet()}catch{}finally{m.value=!1}},V=v(!1),x=v(null),N=_=>{V.value=!0,oe(()=>{x.value=_??null})},e=_=>{L().setDefaultWallet(_.token),w()},D=()=>{w()};return q(()=>{w()}),(_,b)=>{const A=f("el-button"),W=le("loading");return k(),M("div",ie,[te("div",ce,[l(A,{icon:i(re)(i(de)),onClick:b[0]||(b[0]=o=>N())},{default:a(()=>[g(C(i(u)("wallet.btnAdd")),1)]),_:1},8,["icon"])]),ae(l(ne,{data:c.value,connectedWallet:p.connectedWallet,web3:p.web3,currentWallet:d.value,onChangeWallet:e,onRefreshWalletList:D},null,8,["data","connectedWallet","web3","currentWallet"]),[[W,m.value]]),l(se,{visible:V.value,"onUpdate:visible":b[1]||(b[1]=o=>V.value=o),data:x.value,onRefreshWalletList:D},null,8,["visible","data"])])}}});export{We as _};
